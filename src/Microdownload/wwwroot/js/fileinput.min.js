!function(){"use strict";function y(n){return JSON.parse(JSON.stringify(n))}function p(n){for(var t=h(n);"ÿà"<=t[1].slice(0,2)&&t[1].slice(0,2)<="ÿï";)t=[t[0]].concat(t.slice(2));return t.join("")}function c(t){return n(">"+r("B",t.length),t)}function l(t){return n(">"+r("H",t.length),t)}function a(t){return n(">"+r("L",t.length),t)}function w(t,i,u){var f,o,h,v,y="",e="",s,p;if("Byte"==i)f=t.length,4>=f?e=c(t)+r("\x00",4-f):(e=n(">L",[u]),y=c(t));else if("Short"==i)f=t.length,2>=f?e=l(t)+r("\x00\x00",2-f):(e=n(">L",[u]),y=l(t));else if("Long"==i)f=t.length,1>=f?e=a(t):(e=n(">L",[u]),y=a(t));else if("Ascii"==i)o=t+"\x00",f=o.length,f>4?(e=n(">L",[u]),y=o):e=o+r("\x00",4-f);else if("Rational"==i){if("number"==typeof t[0])f=1,h=t[0],v=t[1],o=n(">L",[h])+n(">L",[v]);else for(f=t.length,o="",s=0;f>s;s++)h=t[s][0],v=t[s][1],o+=n(">L",[h])+n(">L",[v]);e=n(">L",[u]);y=o}else if("SRational"==i){if("number"==typeof t[0])f=1,h=t[0],v=t[1],o=n(">l",[h])+n(">l",[v]);else for(f=t.length,o="",s=0;f>s;s++)h=t[s][0],v=t[s][1],o+=n(">l",[h])+n(">l",[v]);e=n(">L",[u]);y=o}else"Undefined"==i&&(f=t.length,f>4?(e=n(">L",[u]),y=t):e=t+r("\x00",4-f));return p=n(">L",[f]),[p,e,y]}function e(t,i,r){var a,h=Object.keys(t).length,y=n(">H",[h]),c,e,f;a=["0th","1st"].indexOf(i)>-1?2+12*h+4:2+12*h;c="";e="";for(f in t)if("string"==typeof f&&(f=parseInt(f)),!("0th"==i&&[34665,34853].indexOf(f)>-1||"Exif"==i&&40965==f||"1st"==i&&[513,514].indexOf(f)>-1)){var o=t[f],p=n(">H",[f]),v=u[i][f].type,b=n(">H",[s[v]]);"number"==typeof o&&(o=[o]);var k=8+a+r+e.length,l=w(o,v,k),d=l[0],g=l[1],nt=l[2];c+=p+b+d+g;e+=nt}return[y+c,e]}function v(n){var i,t;if("ÿØ"==n.slice(0,2))i=h(n),t=b(i),this.tiftag=t?t.slice(10):null;else if(["II","MM"].indexOf(n.slice(0,2))>-1)this.tiftag=n;else{if("Exif"!=n.slice(0,4))throw"Given file is neither JPEG nor TIFF.";this.tiftag=n.slice(6)}}function n(n,t){var e;if(!(t instanceof Array))throw"'pack' error. Got invalid type argument.";if(n.length-1!=t.length)throw"'pack' error. "+(n.length-1)+" marks, "+t.length+" elements.";if("<"==n[0])e=!0;else{if(">"!=n[0])throw"";e=!1}for(var o="",f=1,i=null,u=null,r=null;u=n[f];){if("b"==u.toLowerCase()){if(i=t[f-1],"b"==u&&0>i&&(i+=256),i>255||0>i)throw"'pack' error.";r=String.fromCharCode(i)}else if("H"==u){if(i=t[f-1],i>65535||0>i)throw"'pack' error.";r=String.fromCharCode(Math.floor(i%65536/256))+String.fromCharCode(i%256);e&&(r=r.split("").reverse().join(""))}else{if("l"!=u.toLowerCase())throw"'pack' error.";if(i=t[f-1],"l"==u&&0>i&&(i+=4294967296),i>4294967295||0>i)throw"'pack' error.";r=String.fromCharCode(Math.floor(i/16777216))+String.fromCharCode(Math.floor(i%16777216/65536))+String.fromCharCode(Math.floor(i%65536/256))+String.fromCharCode(i%256);e&&(r=r.split("").reverse().join(""))}o+=r;f+=1}return o}function t(n,t){var o,s,h;if("string"!=typeof t)throw"'unpack' error. Got invalid type argument.";for(o=0,s=1;s<n.length;s++)if("b"==n[s].toLowerCase())o+=1;else if("h"==n[s].toLowerCase())o+=2;else{if("l"!=n[s].toLowerCase())throw"'unpack' error. Got invalid mark.";o+=4}if(o!=t.length)throw"'unpack' error. Mismatch between symbol and string length. "+o+":"+t.length;if("<"==n[0])h=!0;else{if(">"!=n[0])throw"'unpack' error.";h=!1}for(var c=[],u=0,l=1,r=null,f=null,e=null,i="";f=n[l];){if("b"==f.toLowerCase())e=1,i=t.slice(u,u+e),r=i.charCodeAt(0),"b"==f&&r>=128&&(r-=256);else if("H"==f)e=2,i=t.slice(u,u+e),h&&(i=i.split("").reverse().join("")),r=256*i.charCodeAt(0)+i.charCodeAt(1);else{if("l"!=f.toLowerCase())throw"'unpack' error. "+f;e=4;i=t.slice(u,u+e);h&&(i=i.split("").reverse().join(""));r=16777216*i.charCodeAt(0)+65536*i.charCodeAt(1)+256*i.charCodeAt(2)+i.charCodeAt(3);"l"==f&&r>=2147483648&&(r-=4294967296)}c.push(r);u+=e;l+=1}return c}function r(n,t){for(var i="",r=0;t>r;r++)i+=n;return i}function h(n){var i,r,f,u;if("ÿØ"!=n.slice(0,2))throw"Given data isn't JPEG.";for(i=2,r=["ÿØ"];;){if("ÿÚ"==n.slice(i,i+2)){r.push(n.slice(i));break}if(f=t(">H",n.slice(i+2,i+4))[0],u=i+f+2,r.push(n.slice(i,u)),i=u,i>=n.length)throw"Wrong JPEG data.";}return r}function b(n){for(var t,i=0;i<n.length;i++)if(t=n[i],"ÿá"==t.slice(0,2)&&"Exif\x00\x00"==t.slice(4,10))return t;return null}function k(n,t){return"ÿà"==n[1].slice(0,2)&&"ÿá"==n[2].slice(0,2)&&"Exif\x00\x00"==n[2].slice(4,10)?t?(n[2]=t,n=["ÿØ"].concat(n.slice(2))):n=null==t?n.slice(0,2).concat(n.slice(3)):n.slice(0).concat(n.slice(2)):"ÿà"==n[1].slice(0,2)?t&&(n[1]=t):"ÿá"==n[1].slice(0,2)&&"Exif\x00\x00"==n[1].slice(4,10)?t?n[1]=t:null==t&&(n=n.slice(0).concat(n.slice(2))):t&&(n=[n[0],t].concat(n.slice(1))),n.join("")}var i={},o,f,s,u;(i.version="1.03",i.remove=function(n){var r=!1,t,i;if("ÿØ"!=n.slice(0,2)){if("data:image/jpeg;base64,"!=n.slice(0,23)&&"data:image/jpg;base64,"!=n.slice(0,22))throw"Given data is not jpeg.";n=f(n.split(",")[1]);r=!0}if(t=h(n),"ÿá"==t[1].slice(0,2)&&"Exif\x00\x00"==t[1].slice(4,10))t=[t[0]].concat(t.slice(2));else{if("ÿá"!=t[2].slice(0,2)||"Exif\x00\x00"!=t[2].slice(4,10))throw"Exif not found.";t=t.slice(0,2).concat(t.slice(3))}return i=t.join(""),r&&(i="data:image/jpeg;base64,"+o(i)),i},i.insert=function(t,i){var u=!1;if("Exif\x00\x00"!=t.slice(0,6))throw"Given data is not exif.";if("ÿØ"!=i.slice(0,2)){if("data:image/jpeg;base64,"!=i.slice(0,23)&&"data:image/jpg;base64,"!=i.slice(0,22))throw"Given data is not jpeg.";i=f(i.split(",")[1]);u=!0}var e="ÿá"+n(">H",[t.length+2])+t,s=h(i),r=k(s,e);return u&&(r="data:image/jpeg;base64,"+o(r)),r},i.load=function(n){var e,i,r,u,o,s,h;if("string"!=typeof n)throw"'load' gots invalid type argument.";if("ÿØ"==n.slice(0,2))e=n;else if("data:image/jpeg;base64,"==n.slice(0,23)||"data:image/jpg;base64,"==n.slice(0,22))e=f(n.split(",")[1]);else{if("Exif"!=n.slice(0,4))throw"'load' gots invalid file data.";e=n.slice(6)}return(i={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},r=new v(e),null===r.tiftag)?i:(r.endian_mark="II"==r.tiftag.slice(0,2)?"<":">",u=t(r.endian_mark+"L",r.tiftag.slice(4,8))[0],i["0th"]=r.get_ifd(u,"0th"),o=i["0th"].first_ifd_pointer,(delete i["0th"].first_ifd_pointer,34665 in i["0th"]&&(u=i["0th"][34665],i.Exif=r.get_ifd(u,"Exif")),34853 in i["0th"]&&(u=i["0th"][34853],i.GPS=r.get_ifd(u,"GPS")),40965 in i.Exif&&(u=i.Exif[40965],i.Interop=r.get_ifd(u,"Interop")),"\x00\x00\x00\x00"!=o&&(u=t(r.endian_mark+"L",o)[0],i["1st"]=r.get_ifd(u,"1st"),513 in i["1st"]&&514 in i["1st"]))&&(s=i["1st"][513]+i["1st"][514],h=r.tiftag.slice(i["1st"][513],s),i.thumbnail=h),i)},i.dump=function(t){var u,c,lt,at,vt,b=8,r=y(t),l=!1,k=!1,d=!1,it=!1,tt,h,ti;u="0th"in r?r["0th"]:{};"Exif"in r&&Object.keys(r.Exif).length||"Interop"in r&&Object.keys(r.Interop).length?(u[34665]=1,l=!0,c=r.Exif,"Interop"in r&&Object.keys(r.Interop).length?(c[40965]=1,d=!0,lt=r.Interop):Object.keys(c).indexOf(i.ExifIFD.InteroperabilityTag.toString())>-1&&delete c[40965]):Object.keys(u).indexOf(i.ImageIFD.ExifTag.toString())>-1&&delete u[34665];"GPS"in r&&Object.keys(r.GPS).length?(u[i.ImageIFD.GPSTag]=1,k=!0,at=r.GPS):Object.keys(u).indexOf(i.ImageIFD.GPSTag.toString())>-1&&delete u[i.ImageIFD.GPSTag];"1st"in r&&"thumbnail"in r&&null!=r.thumbnail&&(it=!0,r["1st"][513]=1,r["1st"][514]=1,vt=r["1st"]);var a,yt,pt,v,g,nt=e(u,"0th",0),f=nt[0].length+12*l+12*k+4+nt[1].length,wt="",o=0,rt="",w=0,ut="",ft=0,bt="";if((l&&(a=e(c,"Exif",f),o=a[0].length+12*d+a[1].length),k&&(yt=e(at,"GPS",f+o),rt=yt.join(""),w=rt.length),d)&&(tt=f+o+w,pt=e(lt,"Interop",tt),ut=pt.join(""),ft=ut.length),it&&(tt=f+o+w+ft,v=e(vt,"1st",tt),g=p(r.thumbnail),g.length>64e3))throw"Given thumbnail is too large. max 64kB";var kt="",dt="",gt="",ni="\x00\x00\x00\x00";if(l){var h=b+f,et=n(">L",[h]),ot=34665,st=n(">H",[ot]),ht=n(">H",[s.Long]),ct=n(">L",[1]);kt=st+ht+ct+et}if(k){var h=b+f+o,et=n(">L",[h]),ot=34853,st=n(">H",[ot]),ht=n(">H",[s.Long]),ct=n(">L",[1]);dt=st+ht+ct+et}if(d){var h=b+f+o+w,et=n(">L",[h]),ot=40965,st=n(">H",[ot]),ht=n(">H",[s.Long]),ct=n(">L",[1]);gt=st+ht+ct+et}if(it){h=b+f+o+w+ft;ni=n(">L",[h]);var ii=h+v[0].length+24+4+v[1].length,ri="\x02\x01\x00\x04\x00\x00\x00\x01"+n(">L",[ii]),ui="\x02\x02\x00\x04\x00\x00\x00\x01"+n(">L",[g.length]);bt=v[0]+ri+ui+"\x00\x00\x00\x00"+v[1]+g}return ti=nt[0]+kt+dt+ni+nt[1],l&&(wt=a[0]+gt+a[1]),"Exif\x00\x00MM\x00*\x00\x00\x00\b"+ti+wt+rt+ut+bt},v.prototype={get_ifd:function(n,i){for(var f={},o=t(this.endian_mark+"H",this.tiftag.slice(n,n+2))[0],s=n+2,e=["0th","1st"].indexOf(i)>-1?"Image":i,r=0;o>r;r++){n=s+12*r;var h=t(this.endian_mark+"H",this.tiftag.slice(n,n+2))[0],c=t(this.endian_mark+"H",this.tiftag.slice(n+2,n+4))[0],l=t(this.endian_mark+"L",this.tiftag.slice(n+4,n+8))[0],a=this.tiftag.slice(n+8,n+12),v=[c,l,a];h in u[e]&&(f[h]=this.convert_value(v))}return"0th"==i&&(n=s+12*o,f.first_ifd_pointer=this.tiftag.slice(n,n+4)),f},convert_value:function(n){var i,f=null,s=n[0],u=n[1],o=n[2],e;if(1==s)u>4?(i=t(this.endian_mark+"L",o)[0],f=t(this.endian_mark+r("B",u),this.tiftag.slice(i,i+u))):f=t(this.endian_mark+r("B",u),o.slice(0,u));else if(2==s)u>4?(i=t(this.endian_mark+"L",o)[0],f=this.tiftag.slice(i,i+u-1)):f=o.slice(0,u-1);else if(3==s)u>2?(i=t(this.endian_mark+"L",o)[0],f=t(this.endian_mark+r("H",u),this.tiftag.slice(i,i+2*u))):f=t(this.endian_mark+r("H",u),o.slice(0,2*u));else if(4==s)u>1?(i=t(this.endian_mark+"L",o)[0],f=t(this.endian_mark+r("L",u),this.tiftag.slice(i,i+4*u))):f=t(this.endian_mark+r("L",u),o);else if(5==s)if(i=t(this.endian_mark+"L",o)[0],u>1)for(f=[],e=0;u>e;e++)f.push([t(this.endian_mark+"L",this.tiftag.slice(i+8*e,i+4+8*e))[0],t(this.endian_mark+"L",this.tiftag.slice(i+4+8*e,i+8+8*e))[0]]);else f=[t(this.endian_mark+"L",this.tiftag.slice(i,i+4))[0],t(this.endian_mark+"L",this.tiftag.slice(i+4,i+8))[0]];else if(7==s)u>4?(i=t(this.endian_mark+"L",o)[0],f=this.tiftag.slice(i,i+u)):f=o.slice(0,u);else{if(10!=s)throw"Exif might be wrong. Got incorrect value type to decode. type:"+s;if(i=t(this.endian_mark+"L",o)[0],u>1)for(f=[],e=0;u>e;e++)f.push([t(this.endian_mark+"l",this.tiftag.slice(i+8*e,i+4+8*e))[0],t(this.endian_mark+"l",this.tiftag.slice(i+4+8*e,i+8+8*e))[0]]);else f=[t(this.endian_mark+"l",this.tiftag.slice(i,i+4))[0],t(this.endian_mark+"l",this.tiftag.slice(i+4,i+8))[0]]}return f instanceof Array&&1==f.length?f[0]:f}},"undefined"!=typeof window&&"function"==typeof btoa)&&(o=window.btoa);"undefined"==typeof o&&(o=function(n){for(var e,t,i,h,c,o,r,s="",u=0,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";u<n.length;)e=n.charCodeAt(u++),t=n.charCodeAt(u++),i=n.charCodeAt(u++),h=e>>2,c=(3&e)<<4|t>>4,o=(15&t)<<2|i>>6,r=63&i,isNaN(t)?o=r=64:isNaN(i)&&(r=64),s=s+f.charAt(h)+f.charAt(c)+f.charAt(o)+f.charAt(r);return s});"undefined"!=typeof window&&"function"==typeof atob&&(f=window.atob);"undefined"==typeof f&&(f=function(n){var o,s,h,c,f,i,e,r="",t=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");t<n.length;)c=u.indexOf(n.charAt(t++)),f=u.indexOf(n.charAt(t++)),i=u.indexOf(n.charAt(t++)),e=u.indexOf(n.charAt(t++)),o=c<<2|f>>4,s=(15&f)<<4|i>>2,h=(3&i)<<6|e,r+=String.fromCharCode(o),64!=i&&(r+=String.fromCharCode(s)),64!=e&&(r+=String.fromCharCode(h));return r});s={Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10};u={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};u["0th"]=u.Image;u["1st"]=u.Image;i.TAGS=u;i.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041};i.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,Gamma:42240};i.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31};i.InteropIFD={InteroperabilityIndex:1};i.GPSHelper={degToDmsRational:function(n){var t=n%1*60,i=t%1*60,r=Math.floor(n),u=Math.floor(t),f=Math.round(100*i);return[[r,1],[u,1],[f,100]]}};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.piexif=i):window.piexif=i}(),function(n){"use strict";var t=typeof window=="undefined"?null:window;typeof define=="function"&&define.amd?define(function(){return n(t)}):typeof module!="undefined"?module.exports=n(t):t.DOMPurify=n(t)}(function e(n){"use strict";var t=function(n){return e(n)},l;if(t.version="0.7.4",!n||!n.document||n.document.nodeType!==9)return t.isSupported=!1,t;var r=n.document,w=r,b=n.DocumentFragment,wt=n.HTMLTemplateElement,c=n.NodeFilter,bt=n.NamedNodeMap||n.MozNamedAttrMap,kt=n.Text,dt=n.Comment,gt=n.DOMParser;typeof wt=="function"&&(l=r.createElement("template"),l.content&&l.content.ownerDocument&&(r=l.content.ownerDocument));var k=r.implementation,ni=r.createNodeIterator,ti=r.getElementsByTagName,ii=r.createDocumentFragment,ri=w.importNode,u={};t.isSupported=typeof k.createHTMLDocument!="undefined"&&r.documentMode!==9;var i=function(n,t){for(var i=t.length;i--;)typeof t[i]=="string"&&(t[i]=t[i].toLowerCase()),n[t[i]]=!0;return n},d=function(n){var i={};for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i},e=null,g=i({},["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr","svg","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","switch","symbol","text","textpath","title","tref","tspan","view","vkern","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feMerge","feMergeNode","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","#text"]),o=null,nt=i({},["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","coords","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","rows","rowspan","spellcheck","scope","selected","shape","size","span","srclang","start","src","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns","accent-height","accumulate","additivive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mode","min","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","surfacescale","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","u1","u2","unicode","values","viewbox","visibility","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","y","y1","y2","z","zoomandpan","accent","accentunder","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","display","displaystyle","fence","frame","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),tt=null,it=null,v=!0,rt=!1,ut=!1,a=!1,ft=/\{\{[\s\S]*|[\s\S]*\}\}/gm,et=/<%[\s\S]*|[\s\S]*%>/gm,s=!1,h=!1,y=!1,ot=!1,st=!0,p=!0,ui=i({},["audio","head","math","script","style","svg","video"]),fi=i({},["audio","video","img","source"]),ei=i({},["alt","class","for","id","label","name","pattern","placeholder","summary","title","value","style","xmlns"]),ht=null,oi=r.createElement("form"),si=function(n){typeof n!="object"&&(n={});e="ALLOWED_TAGS"in n?i({},n.ALLOWED_TAGS):g;o="ALLOWED_ATTR"in n?i({},n.ALLOWED_ATTR):nt;tt="FORBID_TAGS"in n?i({},n.FORBID_TAGS):{};it="FORBID_ATTR"in n?i({},n.FORBID_ATTR):{};v=n.ALLOW_DATA_ATTR!==!1;rt=n.ALLOW_UNKNOWN_PROTOCOLS||!1;ut=n.SAFE_FOR_JQUERY||!1;a=n.SAFE_FOR_TEMPLATES||!1;s=n.WHOLE_DOCUMENT||!1;h=n.RETURN_DOM||!1;y=n.RETURN_DOM_FRAGMENT||!1;ot=n.RETURN_DOM_IMPORT||!1;st=n.SANITIZE_DOM!==!1;p=n.KEEP_CONTENT!==!1;a&&(v=!1);y&&(h=!0);n.ADD_TAGS&&(e===g&&(e=d(e)),i(e,n.ADD_TAGS));n.ADD_ATTR&&(o===nt&&(o=d(o)),i(o,n.ADD_ATTR));p&&(e["#text"]=!0);Object&&"freeze"in Object&&Object.freeze(n);ht=n},ct=function(n){try{n.parentNode.removeChild(n)}catch(t){n.outerHTML=""}},hi=function(n){var t,i;try{t=(new gt).parseFromString(n,"text/html")}catch(r){}return(t||(t=k.createHTMLDocument(""),i=t.body,i.parentNode.removeChild(i.parentNode.firstElementChild),i.outerHTML=n),typeof t.getElementsByTagName=="function")?t.getElementsByTagName(s?"html":"body")[0]:ti.call(t,s?"html":"body")[0]},lt=function(n){return ni.call(n.ownerDocument||n,n,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT,function(){return c.FILTER_ACCEPT},!1)},ci=function(n){return n instanceof kt||n instanceof dt?!1:typeof n.nodeName!="string"||typeof n.textContent!="string"||typeof n.removeChild!="function"||!(n.attributes instanceof bt)||typeof n.removeAttribute!="function"||typeof n.setAttribute!="function"?!0:!1},at=function(n){var i,t;if(f("beforeSanitizeElements",n,null),ci(n))return ct(n),!0;if(i=n.nodeName.toLowerCase(),f("uponSanitizeElement",n,{tagName:i}),!e[i]||tt[i]){if(p&&!ui[i]&&typeof n.insertAdjacentHTML=="function")try{n.insertAdjacentHTML("AfterEnd",n.innerHTML)}catch(r){}return ct(n),!0}return!ut||n.firstElementChild||n.content&&n.content.firstElementChild||(n.innerHTML=n.textContent.replace(/</g,"&lt;")),a&&n.nodeType===3&&(t=n.textContent,t=t.replace(ft," "),t=t.replace(et," "),n.textContent=t),f("afterSanitizeElements",n,null),!1},li=/^data-[\w.\u00B7-\uFFFF-]/,ai=/^(?:(?:(?:f|ht)tps?|mailto|tel):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,vi=/^(?:\w+script|data):/i,vt=/[\x00-\x20\xA0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,yt=function(t){var l,s,i,u,y,e,h,c;if(f("beforeSanitizeAttributes",t,null),e=t.attributes,e){for(h={attrName:"",attrValue:"",keepAttr:!0},c=e.length;c--;)if((l=e[c],s=l.name,i=l.value,u=s.toLowerCase(),h.attrName=u,h.attrValue=i,h.keepAttr=!0,f("uponSanitizeAttribute",t,h),i=h.attrValue,u==="name"&&t.nodeName==="IMG"&&e.id?(y=e.id,e=Array.prototype.slice.apply(e),t.removeAttribute("id"),t.removeAttribute(s),e.indexOf(y)>c&&t.setAttribute("id",y.value)):(s==="id"&&t.setAttribute(s,""),t.removeAttribute(s)),h.keepAttr)&&(!st||u!=="id"&&u!=="name"||!(i in n||i in r||i in oi))&&(a&&(i=i.replace(ft," "),i=i.replace(et," ")),o[u]&&!it[u]&&(ei[u]||ai.test(i.replace(vt,""))||u==="src"&&i.indexOf("data:")===0&&fi[t.nodeName.toLowerCase()])||v&&li.test(u)||rt&&!vi.test(i.replace(vt,""))))try{t.setAttribute(s,i)}catch(p){}f("afterSanitizeAttributes",t,null)}},pt=function(n){var t,i=lt(n);for(f("beforeSanitizeShadowDOM",n,null);t=i.nextNode();)(f("uponSanitizeShadowNode",t,null),at(t))||(t.content instanceof b&&pt(t.content),yt(t));f("afterSanitizeShadowDOM",n,null)},f=function(n,i,r){u[n]&&u[n].forEach(function(n){n.call(t,i,r,ht)})};return t.sanitize=function(i,r){var u,f,o,c,e;if(i||(i=""),typeof i!="string")if(typeof i.toString!="function")throw new TypeError("toString is not a function");else i=i.toString();if(!t.isSupported)return typeof n.toStaticHTML=="object"||typeof n.toStaticHTML=="function"?n.toStaticHTML(i):i;if(si(r),!h&&!s&&i.indexOf("<")===-1)return i;if(u=hi(i),!u)return h?null:"";for(c=lt(u);f=c.nextNode();)(f.nodeType!==3||f!==o)&&(at(f)||(f.content instanceof b&&pt(f.content),yt(f),o=f));if(h){if(y)for(e=ii.call(u.ownerDocument);u.firstChild;)e.appendChild(u.firstChild);else e=u;return ot&&(e=ri.call(w,e,!0)),e}return s?u.outerHTML:u.innerHTML},t.addHook=function(n,t){typeof t=="function"&&(u[n]=u[n]||[],u[n].push(t))},t.removeHook=function(n){u[n]&&u[n].pop()},t.removeHooks=function(n){u[n]&&(u[n]=[])},t.removeAllHooks=function(){u=[]},t});!function(n){"use strict";"function"==typeof define&&define.amd?define(n):"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=n():window.KvSortable=n()}(function(){"use strict";function h(n,t){var f,u,i;if(!n||!n.nodeType||1!==n.nodeType)throw"KvSortable: `el` must be HTMLElement, and not "+{}.toString.call(n);this.el=n;this.options=t=ii({},t);n[g]=this;f={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(n.nodeName)?"li":">*",ghostClass:"kvsortable-ghost",chosenClass:"kvsortable-chosen",dragClass:"kvsortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,setData:function(n,t){n.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"kvsortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0}};for(u in f)u in t||(t[u]=f[u]);si(t);for(i in this)"_"===i.charAt(0)&&"function"==typeof this[i]&&(this[i]=this[i].bind(this));this.nativeDraggable=t.forceFallback?!1:wi;r(n,"mousedown",this._onTapStart);r(n,"touchstart",this._onTapStart);r(n,"pointerdown",this._onTapStart);this.nativeDraggable&&(r(n,"dragover",this),r(n,"dragenter",this));rt.push(this._onDragOver);t.store&&this.sort(t.store.get(this))}function st(i,r){"clone"!==i.lastPullMode&&(r=!0);o&&o.state!==r&&(u(o,"display",r?"none":""),r||o.state&&(i.options.group.revertClone?(t.insertBefore(o,nt),i._animate(n,o)):t.insertBefore(o,n)),o.state=r)}function w(n,t,i){if(n){i=i||f;do if(">*"===t&&n.parentNode===i||ni(n,t))return n;while(n=hi(n))}return null}function hi(n){var t=n.host;return t&&t.nodeType?t:n.parentNode}function ci(n){n.dataTransfer&&(n.dataTransfer.dropEffect="move");n.preventDefault()}function r(n,t,i){n.addEventListener(t,i,pt)}function e(n,t,i){n.removeEventListener(t,i,pt)}function a(n,t,i){if(n)if(n.classList)n.classList[i?"add":"remove"](t);else{var r=(" "+n.className+" ").replace(ui," ").replace(" "+t+" "," ");n.className=(r+(i?" "+t:"")).replace(ui," ")}}function u(n,t,i){var r=n&&n.style;if(r){if(void 0===i)return f.defaultView&&f.defaultView.getComputedStyle?i=f.defaultView.getComputedStyle(n,""):n.currentStyle&&(i=n.currentStyle),void 0===t?i:i[t];t in r||(t="-webkit-"+t);r[t]=i+("string"==typeof i?"":"px")}}function kt(n,t,i){if(n){var u=n.getElementsByTagName(t),r=0,f=u.length;if(i)for(;f>r;r++)i(u[r],r);return u}return[]}function l(n,t,i,r,u,e,s){n=n||t[g];var h=f.createEvent("Event"),c=n.options,l="on"+i.charAt(0).toUpperCase()+i.substr(1);h.initEvent(i,!0,!0);h.to=t;h.from=u||t;h.item=r||t;h.clone=o;h.oldIndex=e;h.newIndex=s;t.dispatchEvent(h);c[l]&&c[l].call(n,h)}function dt(n,t,i,r,u,e,o){var s,h,c=n[g],l=c.options.onMove;return s=f.createEvent("Event"),s.initEvent("move",!0,!0),s.to=t,s.from=n,s.dragged=i,s.draggedRect=r,s.related=u||t,s.relatedRect=e||t.getBoundingClientRect(),n.dispatchEvent(s),l&&(h=l.call(c,s,o)),h}function gt(n){n.draggable=!1}function li(){wt=!1}function ai(n,t){var r=n.lastElementChild,i=r.getBoundingClientRect();return(t.clientY-(i.top+i.height)>5||t.clientX-(i.right+i.width)>5)&&r}function vi(n){for(var t=n.tagName+n.className+n.src+n.href+n.textContent,i=t.length,r=0;i--;)r+=t.charCodeAt(i);return r.toString(36)}function ut(n,t){var i=0;if(!n||!n.parentNode)return-1;for(;n&&(n=n.previousElementSibling);)"TEMPLATE"!==n.nodeName.toUpperCase()&&(">*"===t||ni(n,t))&&i++;return i}function ni(n,t){if(n){t=t.split(".");var i=t.shift().toUpperCase(),r=new RegExp("\\s("+t.join("|")+")(?=\\s)","g");return!(""!==i&&n.nodeName.toUpperCase()!=i||t.length&&((" "+n.className+" ").match(r)||[]).length!=t.length)}return!1}function ti(n,t){var i,r;return function(){void 0===i&&(i=arguments,r=this,setTimeout(function(){1===i.length?n.call(r,i[0]):n.apply(r,i);i=void 0},t))}}function ii(n,t){if(n&&t)for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}function ri(n){return ei?ei(n).clone(!0)[0]:yt&&yt.dom?yt.dom(n).cloneNode(!0):n.cloneNode(!0)}function yi(n){for(var r,t=n.getElementsByTagName("input"),i=t.length;i--;)r=t[i],r.checked&&bt.push(r)}if("undefined"==typeof window||!window.document)return function(){throw new Error("KvSortable.js requires a window with a document");};var n,b,i,o,t,nt,ht,c,ct,lt,at,ft,vt,v,s,it,et,d,y,ot,k={},ui=/\s+/g,pi=/left|right|inline/,g="KvSortable"+(new Date).getTime(),p=window,f=p.document,fi=p.parseInt,ei=p.jQuery||p.Zepto,yt=p.Polymer,pt=!1,wi=!!("draggable"in f.createElement("div")),oi=function(n){return navigator.userAgent.match(/Trident.*rv[ :]?11\./)?!1:(n=f.createElement("x"),n.style.cssText="pointer-events:auto","auto"===n.style.pointerEvents)}(),wt=!1,tt=Math.abs,bi=Math.min,bt=[],rt=[],ki=ti(function(n,t,i){if(i&&t.scroll){var r,o,u,f,s,h,y=i[g],e=t.scrollSensitivity,v=t.scrollSpeed,l=n.clientX,a=n.clientY,w=window.innerWidth,b=window.innerHeight;if(ct!==i&&(c=t.scroll,ct=i,lt=t.scrollFn,c===!0)){c=i;do if(c.offsetWidth<c.scrollWidth||c.offsetHeight<c.scrollHeight)break;while(c=c.parentNode)}c&&(r=c,o=c.getBoundingClientRect(),u=(tt(o.right-l)<=e)-(tt(o.left-l)<=e),f=(tt(o.bottom-a)<=e)-(tt(o.top-a)<=e));u||f||(u=(e>=w-l)-(e>=l),f=(e>=b-a)-(e>=a),(u||f)&&(r=p));k.vx===u&&k.vy===f&&k.el===r||(k.el=r,k.vx=u,k.vy=f,clearInterval(k.pid),r&&(k.pid=setInterval(function(){return h=f?f*v:0,s=u?u*v:0,"function"==typeof lt?lt.call(y,s,h,n):void(r===p?p.scrollTo(p.pageXOffset+s,p.pageYOffset+h):(r.scrollTop+=h,r.scrollLeft+=s))},24)))}},30),si=function(n){function r(n,t){return void 0!==n&&n!==!0||(n=i.name),"function"==typeof n?n:function(i,r){var u=r.options.group.name;return t?n:n&&(n.join?n.indexOf(u)>-1:u==n)}}var i={},t=n.group;t&&"object"==typeof t||(t={name:t});i.name=t.name;i.checkPull=r(t.pull,!0);i.checkPut=r(t.put);i.revertClone=t.revertClone;n.group=i};h.prototype={constructor:h,_onTapStart:function(t){var e,s=this,u=this.el,r=this.options,h=r.preventOnFilter,a=t.type,c=t.touches&&t.touches[0],i=(c||t).target,o=t.target.shadowRoot&&t.path[0]||i,f=r.filter;if(yi(u),!n&&!("mousedown"===a&&0!==t.button||r.disabled)&&(i=w(i,r.draggable,u),i&&ht!==i)){if(e=ut(i,r.draggable),"function"==typeof f){if(f.call(this,t,i,this))return l(s,o,"filter",i,u,e),void(h&&t.preventDefault())}else if(f&&(f=f.split(",").some(function(n){return n=w(o,n.trim(),u),n?(l(s,n,"filter",i,u,e),!0):void 0})))return void(h&&t.preventDefault());r.handle&&!w(o,r.handle,u)||this._prepareDragStart(t,c,i,e)}},_prepareDragStart:function(i,u,f,e){var c,o=this,y=o.el,h=o.options,s=y.ownerDocument;f&&!n&&f.parentNode===y&&(d=i,t=y,n=f,b=n.parentNode,nt=n.nextSibling,ht=f,it=h.group,v=e,this._lastX=(u||i).clientX,this._lastY=(u||i).clientY,n.style["will-change"]="transform",c=function(){o._disableDelayedDrag();n.draggable=o.nativeDraggable;a(n,h.chosenClass,!0);o._triggerDragStart(i,u);l(o,t,"choose",n,t,v)},h.ignore.split(",").forEach(function(t){kt(n,t.trim(),gt)}),r(s,"mouseup",o._onDrop),r(s,"touchend",o._onDrop),r(s,"touchcancel",o._onDrop),r(s,"pointercancel",o._onDrop),r(s,"selectstart",o),h.delay?(r(s,"mouseup",o._disableDelayedDrag),r(s,"touchend",o._disableDelayedDrag),r(s,"touchcancel",o._disableDelayedDrag),r(s,"mousemove",o._disableDelayedDrag),r(s,"touchmove",o._disableDelayedDrag),r(s,"pointermove",o._disableDelayedDrag),o._dragStartTimer=setTimeout(c,h.delay)):c())},_disableDelayedDrag:function(){var n=this.el.ownerDocument;clearTimeout(this._dragStartTimer);e(n,"mouseup",this._disableDelayedDrag);e(n,"touchend",this._disableDelayedDrag);e(n,"touchcancel",this._disableDelayedDrag);e(n,"mousemove",this._disableDelayedDrag);e(n,"touchmove",this._disableDelayedDrag);e(n,"pointermove",this._disableDelayedDrag)},_triggerDragStart:function(i,u){u=u||("touch"==i.pointerType?i:null);u?(d={target:n,clientX:u.clientX,clientY:u.clientY},this._onDragStart(d,"touch")):this.nativeDraggable?(r(n,"dragend",this),r(t,"dragstart",this._onDragStart)):this._onDragStart(d,!0);try{f.selection?setTimeout(function(){f.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(){if(t&&n){var i=this.options;a(n,i.ghostClass,!0);a(n,i.dragClass,!1);h.active=this;l(this,t,"start",n,t,v)}else this._nulling()},_emulateDragOver:function(){if(y){if(this._lastX===y.clientX&&this._lastY===y.clientY)return;this._lastX=y.clientX;this._lastY=y.clientY;oi||u(i,"display","none");var t=f.elementFromPoint(y.clientX,y.clientY),n=t,r=rt.length;if(n)do{if(n[g]){for(;r--;)rt[r]({clientX:y.clientX,clientY:y.clientY,target:t,rootEl:n});break}t=n}while(n=n.parentNode);oi||u(i,"display","")}},_onTouchMove:function(n){if(d){var f=this.options,e=f.fallbackTolerance,o=f.fallbackOffset,t=n.touches?n.touches[0]:n,s=t.clientX-d.clientX+o.x,c=t.clientY-d.clientY+o.y,r=n.touches?"translate3d("+s+"px,"+c+"px,0)":"translate("+s+"px,"+c+"px)";if(!h.active){if(e&&bi(tt(t.clientX-this._lastX),tt(t.clientY-this._lastY))<e)return;this._dragStarted()}this._appendGhost();ot=!0;y=t;u(i,"webkitTransform",r);u(i,"mozTransform",r);u(i,"msTransform",r);u(i,"transform",r);n.preventDefault()}},_appendGhost:function(){if(!i){var o,r=n.getBoundingClientRect(),s=u(n),e=this.options;i=n.cloneNode(!0);a(i,e.ghostClass,!1);a(i,e.fallbackClass,!0);a(i,e.dragClass,!0);u(i,"top",r.top-fi(s.marginTop,10));u(i,"left",r.left-fi(s.marginLeft,10));u(i,"width",r.width);u(i,"height",r.height);u(i,"opacity","0.8");u(i,"position","fixed");u(i,"zIndex","100000");u(i,"pointerEvents","none");e.fallbackOnBody&&f.body.appendChild(i)||t.appendChild(i);o=i.getBoundingClientRect();u(i,"width",2*r.width-o.width);u(i,"height",2*r.height-o.height)}},_onDragStart:function(i,e){var s=i.dataTransfer,h=this.options;this._offUpEvents();it.checkPull(this,this,n,i)&&(o=ri(n),o.draggable=!1,o.style["will-change"]="",u(o,"display","none"),a(o,this.options.chosenClass,!1),t.insertBefore(o,n),l(this,t,"clone",n));a(n,h.dragClass,!0);e?("touch"===e?(r(f,"touchmove",this._onTouchMove),r(f,"touchend",this._onDrop),r(f,"touchcancel",this._onDrop),r(f,"pointermove",this._onTouchMove),r(f,"pointerup",this._onDrop)):(r(f,"mousemove",this._onTouchMove),r(f,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,50)):(s&&(s.effectAllowed="move",h.setData&&h.setData.call(this,s,n)),r(f,"drop",this),setTimeout(this._dragStarted,0))},_onDragOver:function(r){var f,a,e,rt,s=this.el,l=this.options,ut=l.group,c=h.active,p=it===ut,ht=!1,ct=l.sort,d,tt;if(void 0!==r.preventDefault&&(r.preventDefault(),!l.dragoverBubble&&r.stopPropagation()),!n.animated&&(ot=!0,c&&!l.disabled&&(p?ct||(rt=!t.contains(n)):et===this||(c.lastPullMode=it.checkPull(this,c,n,r))&&ut.checkPut(this,c,n,r))&&(void 0===r.rootEl||r.rootEl===this.el))){if(ki(r,l,this.el),wt)return;if(f=w(r.target,l.draggable,s),a=n.getBoundingClientRect(),et!==this&&(et=this,ht=!0),rt)return st(c,!0),b=t,void(o||nt?t.insertBefore(n,o||nt):ct||t.appendChild(n));if(0===s.children.length||s.children[0]===i||s===r.target&&(f=ai(s,r))){if(f){if(f.animated)return;e=f.getBoundingClientRect()}st(c,p);dt(t,s,n,a,f,e,r)!==!1&&(n.contains(s)||(s.appendChild(n),b=s),this._animate(a,n),f&&this._animate(e,f))}else if(f&&!f.animated&&f!==n&&void 0!==f.parentNode[g]){at!==f&&(at=f,ft=u(f),vt=u(f.parentNode));e=f.getBoundingClientRect();var gt=e.right-e.left,lt=e.bottom-e.top,yt=pi.test(ft.cssFloat+ft.display)||"flex"==vt.display&&0===vt["flex-direction"].indexOf("row"),pt=f.offsetWidth>n.offsetWidth,bt=f.offsetHeight>n.offsetHeight,kt=(yt?(r.clientX-e.left)/gt:(r.clientY-e.top)/lt)>.5,k=f.nextElementSibling,y=dt(t,s,n,a,f,e,r),v=!1;y!==!1&&((wt=!0,setTimeout(li,30),st(c,p),1===y||-1===y)?v=1===y:yt?(d=n.offsetTop,tt=f.offsetTop,v=d===tt?f.previousElementSibling===n&&!pt||kt&&pt:f.previousElementSibling===n||n.previousElementSibling===f?(r.clientY-e.top)/lt>.5:tt>d):ht||(v=k!==n&&!bt||kt&&bt),n.contains(s)||(v&&!k?s.appendChild(n):f.parentNode.insertBefore(n,v?k:f)),b=n.parentNode,this._animate(a,n),this._animate(e,f))}}},_animate:function(n,t){var i=this.options.animation,r;i&&(r=t.getBoundingClientRect(),1===n.nodeType&&(n=n.getBoundingClientRect()),u(t,"transition","none"),u(t,"transform","translate3d("+(n.left-r.left)+"px,"+(n.top-r.top)+"px,0)"),t.offsetWidth,u(t,"transition","all "+i+"ms"),u(t,"transform","translate3d(0,0,0)"),clearTimeout(t.animated),t.animated=setTimeout(function(){u(t,"transition","");u(t,"transform","");t.animated=!1},i))},_offUpEvents:function(){var n=this.el.ownerDocument;e(f,"touchmove",this._onTouchMove);e(f,"pointermove",this._onTouchMove);e(n,"mouseup",this._onDrop);e(n,"touchend",this._onDrop);e(n,"pointerup",this._onDrop);e(n,"touchcancel",this._onDrop);e(n,"selectstart",this)},_onDrop:function(r){var c=this.el,u=this.options;clearInterval(this._loopId);clearInterval(k.pid);clearTimeout(this._dragStartTimer);e(f,"mousemove",this._onTouchMove);this.nativeDraggable&&(e(f,"drop",this),e(c,"dragstart",this._onDragStart));this._offUpEvents();r&&(ot&&(r.preventDefault(),!u.dropBubble&&r.stopPropagation()),i&&i.parentNode.removeChild(i),t!==b&&"clone"===h.active.lastPullMode||o&&o.parentNode.removeChild(o),n&&(this.nativeDraggable&&e(n,"dragend",this),gt(n),n.style["will-change"]="",a(n,this.options.ghostClass,!1),a(n,this.options.chosenClass,!1),t!==b?(s=ut(n,u.draggable),s>=0&&(l(null,b,"add",n,t,v,s),l(this,t,"remove",n,t,v,s),l(null,b,"sort",n,t,v,s),l(this,t,"sort",n,t,v,s))):n.nextSibling!==nt&&(s=ut(n,u.draggable),s>=0&&(l(this,t,"update",n,t,v,s),l(this,t,"sort",n,t,v,s))),h.active&&(null!=s&&-1!==s||(s=v),l(this,t,"end",n,t,v,s),this.save())));this._nulling()},_nulling:function(){t=n=b=i=nt=o=ht=c=ct=d=y=ot=s=at=ft=et=it=h.active=null;bt.forEach(function(n){n.checked=!0});bt.length=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragover":case"dragenter":n&&(this._onDragOver(t),ci(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var n,i=[],r=this.el.children,t=0,f=r.length,u=this.options;f>t;t++)n=r[t],w(n,u.draggable,this.el)&&i.push(n.getAttribute(u.dataIdAttr)||vi(n));return i},sort:function(n){var t={},i=this.el;this.toArray().forEach(function(n,r){var u=i.children[r];w(u,this.options.draggable,i)&&(t[n]=u)},this);n.forEach(function(n){t[n]&&(i.removeChild(t[n]),i.appendChild(t[n]))})},save:function(){var n=this.options.store;n&&n.set(this)},closest:function(n,t){return w(n,t||this.options.draggable,this.el)},option:function(n,t){var i=this.options;return void 0===t?i[n]:(i[n]=t,void("group"===n&&si(i)))},destroy:function(){var n=this.el;n[g]=null;e(n,"mousedown",this._onTapStart);e(n,"touchstart",this._onTapStart);e(n,"pointerdown",this._onTapStart);this.nativeDraggable&&(e(n,"dragover",this),e(n,"dragenter",this));Array.prototype.forEach.call(n.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")});rt.splice(rt.indexOf(this._onDragOver),1);this._onDrop();this.el=n=null}};r(f,"touchmove",function(n){h.active&&n.preventDefault()});try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){pt={capture:!1,passive:!1}}}))}catch(di){}return h.utils={on:r,off:e,css:u,find:kt,is:function(n,t){return!!w(n,t,n)},extend:ii,throttle:ti,closest:w,toggleClass:a,clone:ri,index:ut},h.create=function(n,t){return new h(n,t)},h.version="1.5.1",h}),function(n){"use strict";"function"==typeof define&&define.amd?define(["jquery"],n):n(jQuery)}(function(n){"use strict";n.fn.kvsortable=function(t){var i,r=arguments;return this.each(function(){var f=n(this),u=f.data("kvsortable");!u&&(t instanceof Object||!t)&&(u=new KvSortable(this,t),f.data("kvsortable",u));u&&("widget"===t?i=u:"destroy"===t?(u.destroy(),f.removeData("kvsortable")):"function"==typeof u[t]?i=u[t].apply(u,[].slice.call(r,1)):t in u.options&&(i=u.option.apply(u,r)))}),void 0===i?this:i}});
/*!
 * bootstrap-fileinput v4.4.2
 * http://plugins.krajee.com/file-input
 *
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2017, Kartik Visweswaran, Krajee.com
 *
 * Licensed under the BSD 3-Clause
 * https://github.com/kartik-v/bootstrap-fileinput/blob/master/LICENSE.md
 */
!function(n){"use strict";"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=n(require("jquery")):n(window.jQuery)}(function(n){"use strict";n.fn.fileinputLocales={};n.fn.fileinputThemes={};String.prototype.setTokens=function(n){var t,r,i=this.toString();for(t in n)n.hasOwnProperty(t)&&(r=new RegExp("{"+t+"}","g"),i=i.replace(r,n[t]));return i};var t,i;t={FRAMES:".kv-preview-thumb",SORT_CSS:"file-sortable",STYLE_SETTING:'style="width:{width};height:{height};"',OBJECT_PARAMS:'<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}<\/span>\n<\/div>',MODAL_ID:"kvFileinputModal",MODAL_EVENTS:["show","shown","hide","hidden","loaded"],objUrl:window.URL||window.webkitURL,compare:function(n,t,i){return void 0!==n&&(i?n===t:n.match(t))},isIE:function(n){if("Microsoft Internet Explorer"!==navigator.appName)return!1;if(10===n)return new RegExp("msie\\s"+n,"i").test(navigator.userAgent);var i,t=document.createElement("div");return t.innerHTML="<!--[if IE "+n+"]> <i><\/i> <![endif]-->",i=t.getElementsByTagName("i").length,document.body.appendChild(t),t.parentNode.removeChild(t),i},initModal:function(t){var i=n("body");i.length&&t.appendTo(i)},isEmpty:function(t,i){return void 0===t||null===t||0===t.length||i&&""===n.trim(t)},isArray:function(n){return Array.isArray(n)||"[object Array]"===Object.prototype.toString.call(n)},ifSet:function(n,t,i){return i=i||"",t&&"object"==typeof t&&n in t?t[n]:i},cleanArray:function(n){return n instanceof Array||(n=[]),n.filter(function(n){return void 0!==n&&null!==n})},spliceArray:function(n,t){var i,r=0,u=[];if(!(n instanceof Array))return[];for(i=0;i<n.length;i++)i!==t&&(u[r]=n[i],r++);return u},getNum:function(n,t){return t=t||0,"number"==typeof n?n:("string"==typeof n&&(n=parseFloat(n)),isNaN(n)?t:n)},hasFileAPISupport:function(){return!(!window.File||!window.FileReader)},hasDragDropSupport:function(){var n=document.createElement("div");return!t.isIE(9)&&(void 0!==n.draggable||void 0!==n.ondragstart&&void 0!==n.ondrop)},hasFileUploadSupport:function(){return t.hasFileAPISupport()&&window.FormData},hasBlobSupport:function(){try{return!!window.Blob&&Boolean(new Blob)}catch(n){return!1}},hasArrayBufferViewSupport:function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(n){return!1}},dataURI2Blob:function(n){var r,u,f,i,e,o,s=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,h=t.hasBlobSupport(),c=(h||s)&&window.atob&&window.ArrayBuffer&&window.Uint8Array;if(!c)return null;for(r=n.split(",")[0].indexOf("base64")>=0?atob(n.split(",")[1]):decodeURIComponent(n.split(",")[1]),u=new ArrayBuffer(r.length),f=new Uint8Array(u),i=0;i<r.length;i+=1)f[i]=r.charCodeAt(i);return e=n.split(",")[0].split(":")[1].split(";")[0],h?new Blob([t.hasArrayBufferViewSupport()?f:u],{type:e}):(o=new s,o.append(u),o.getBlob(e))},addCss:function(n,t){n.removeClass(t).addClass(t)},getElement:function(i,r,u){return t.isEmpty(i)||t.isEmpty(i[r])?u:n(i[r])},uniqId:function(){return Math.round((new Date).getTime()+100*Math.random())},htmlEncode:function(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags:function(t,i){var r=t;return i?(n.each(i,function(n,t){"function"==typeof t&&(t=t());r=r.split(n).join(t)}),r):r},cleanMemory:function(n){var i=n.is("img")?n.attr("src"):n.find("source").attr("src");t.objUrl.revokeObjectURL(i)},findFileName:function(n){var t=n.lastIndexOf("/");return-1===t&&(t=n.lastIndexOf("\\")),n.split(n.substring(t,t+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(n){var i=document,r=i.documentElement;r&&n&&!t.checkFullScreen()?r.requestFullscreen?r.requestFullscreen():r.msRequestFullscreen?r.msRequestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen&&r.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):i.exitFullscreen?i.exitFullscreen():i.msExitFullscreen?i.msExitFullscreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitExitFullscreen&&i.webkitExitFullscreen()},moveArray:function(n,t,i){if(i>=n.length)for(var r=i-n.length;r--+1;)n.push(void 0);return n.splice(i,0,n.splice(t,1)[0]),n},cleanZoomCache:function(n){var t=n.closest(".kv-zoom-cache-theme");t.length||(t=n.closest(".kv-zoom-cache"));t.remove()},setOrientation:function(n,t){var u,f,e,r=new DataView(n),i=0,o=1;if(!(65496!==r.getUint16(i)||n.length<2)){for(i+=2,u=r.byteLength;u-2>i;)switch(f=r.getUint16(i),i+=2,f){case 65505:e=r.getUint16(i);u=e-i;i+=2;break;case 274:o=r.getUint16(i+6,!1);u=0}t&&t(o)}},validateOrientation:function(n,i){if(window.FileReader&&window.DataView){var u,r=new FileReader;r.onloadend=function(){u=r.result;t.setOrientation(u,i)};r.readAsArrayBuffer(n)}},adjustOrientedImage:function(n,t){var i,r,u;if(n.hasClass("is-portrait-gt4")){if(t)return void n.css({width:n.parent().height()});n.css({height:"auto",width:n.height()});i=n.parent().offset().top;r=n.offset().top;u=i-r;n.css("margin-top",u)}}};i=function(i,r){var u=this;u.$element=n(i);u._validate()&&(u.isPreviewable=t.hasFileAPISupport(),u.isIE9=t.isIE(9),u.isIE10=t.isIE(10),u.isPreviewable||u.isIE9?(u._init(r),u._listen()):u.$element.removeClass("file-loading"))};i.prototype={constructor:i,_cleanup:function(){var n=this;n.reader=null;n.formdata={};n.uploadCount=0;n.uploadStatus={};n.uploadLog=[];n.uploadAsyncCount=0;n.loadedImages=[];n.totalImagesCount=0;n.ajaxRequests=[];n.clearStack();n.fileInputCleared=!1;n.fileBatchCompleted=!0;n.isPreviewable||(n.showPreview=!1);n.isError=!1;n.ajaxAborted=!1;n.cancelling=!1},_init:function(i){var f,e,o,r=this,u=r.$element;r.options=i;n.each(i,function(n,i){switch(n){case"minFileCount":case"maxFileCount":case"minFileSize":case"maxFileSize":case"maxFilePreviewSize":case"resizeImageQuality":case"resizeIfSizeMoreThan":case"progressUploadThreshold":case"initialPreviewCount":case"zoomModalHeight":case"minImageHeight":case"maxImageHeight":case"minImageWidth":case"maxImageWidth":r[n]=t.getNum(i);break;default:r[n]=i}});r.rtl&&(o=r.previewZoomButtonIcons.prev,r.previewZoomButtonIcons.prev=r.previewZoomButtonIcons.next,r.previewZoomButtonIcons.next=o);r._cleanup();r.$form=u.closest("form");r._initTemplateDefaults();r.uploadFileAttr=t.isEmpty(u.attr("name"))?"file_data":u.attr("name");e=r._getLayoutTemplate("progress");r.progressTemplate=e.replace("{class}",r.progressClass);r.progressCompleteTemplate=e.replace("{class}",r.progressCompleteClass);r.progressErrorTemplate=e.replace("{class}",r.progressErrorClass);r.dropZoneEnabled=t.hasDragDropSupport()&&r.dropZoneEnabled;r.isDisabled=u.attr("disabled")||u.attr("readonly");r.isDisabled&&u.attr("disabled",!0);r.isUploadable=t.hasFileUploadSupport()&&!t.isEmpty(r.uploadUrl);r.isClickable=r.browseOnZoneClick&&r.showPreview&&(r.isUploadable&&r.dropZoneEnabled||!t.isEmpty(r.defaultPreviewContent));r.slug="function"==typeof i.slugCallback?i.slugCallback:r._slugDefault;r.mainTemplate=r.showCaption?r._getLayoutTemplate("main1"):r._getLayoutTemplate("main2");r.captionTemplate=r._getLayoutTemplate("caption");r.previewGenericTemplate=r._getPreviewTemplate("generic");r.resizeImage&&(r.maxImageWidth||r.maxImageHeight)&&(r.imageCanvas=document.createElement("canvas"),r.imageCanvasContext=r.imageCanvas.getContext("2d"));t.isEmpty(u.attr("id"))&&u.attr("id",t.uniqId());r.namespace=".fileinput_"+u.attr("id").replace(/-/g,"_");void 0===r.$container?r.$container=r._createContainer():r._refreshContainer();f=r.$container;r.$dropZone=f.find(".file-drop-zone");r.$progress=f.find(".kv-upload-progress");r.$btnUpload=f.find(".fileinput-upload");r.$captionContainer=t.getElement(i,"elCaptionContainer",f.find(".file-caption"));r.$caption=t.getElement(i,"elCaptionText",f.find(".file-caption-name"));r.$previewContainer=t.getElement(i,"elPreviewContainer",f.find(".file-preview"));r.$preview=t.getElement(i,"elPreviewImage",f.find(".file-preview-thumbnails"));r.$previewStatus=t.getElement(i,"elPreviewStatus",f.find(".file-preview-status"));r.$errorContainer=t.getElement(i,"elErrorContainer",r.$previewContainer.find(".kv-fileinput-error"));t.isEmpty(r.msgErrorClass)||t.addCss(r.$errorContainer,r.msgErrorClass);r.$errorContainer.hide();r.previewInitId="preview-"+t.uniqId();r._initPreviewCache();r._initPreview(!0);r._initPreviewActions();r._setFileDropZoneTitle();u.removeClass("file-loading");u.attr("disabled")&&r.disable();r._initZoom();r.hideThumbnailContent&&t.addCss(r.$preview,"hide-content")},_initTemplateDefaults:function(){var f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,u,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,r,i=this;f='{preview}\n<div class="kv-upload-progress hide"><\/div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   <\/div>\n<\/div>';e='{preview}\n<div class="kv-upload-progress hide"><\/div>\n{remove}\n{cancel}\n{upload}\n{browse}\n';o='<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    <\/div>\n    <div class="clearfix"><\/div>    <div class="file-preview-status text-center text-success"><\/div>\n    <div class="kv-fileinput-error"><\/div>\n    <\/div>\n<\/div>';h='<div class="close fileinput-remove">&times;<\/div>\n';s='<i class="glyphicon glyphicon-file kv-caption-icon"><\/i>';c='<div tabindex="500" class="form-control file-caption {class}">\n   <div class="file-caption-name"><\/div>\n<\/div>\n';l='<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}<\/button>';a='<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}<\/a>';v='<div tabindex="500" class="{css}" {status}>{icon} {label}<\/div>';y='<div id="'+t.MODAL_ID+'" class="file-zoom-dialog modal fade" tabindex="-1" aria-labelledby="'+t.MODAL_ID+'Label"><\/div>';p='<div class="modal-dialog modal-lg{rtl}" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <div class="kv-zoom-actions pull-right">{toggleheader}{fullscreen}{borderless}{close}<\/div>\n      <h3 class="modal-title">{heading} <small><span class="kv-zoom-title"><\/span><\/small><\/h3>\n    <\/div>\n    <div class="modal-body">\n      <div class="floating-buttons"><\/div>\n      <div class="kv-zoom-body file-zoom-content {zoomFrameClass}"><\/div>\n{prev} {next}\n    <\/div>\n  <\/div>\n<\/div>\n';w='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {status}\n     <\/div>\n<\/div>';b=" <samp>({sizeText})<\/samp>";k='<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">{caption}<br>{size}<\/div>\n    {progress} {indicator} {actions}\n<\/div>';d='{drag}\n<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload} {delete} {zoom} {other}    <\/div>\n    <div class="clearfix"><\/div>\n<\/div>';g='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}<\/button>\n';nt='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}<\/button>';tt='<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}<\/button>';it='<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}<\/span>';rt='<div class="file-upload-indicator" title="{indicatorTitle}">{indicator}<\/div>';u='<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"';ut=u+'><div class="kv-file-content">\n';ft=u+' title="{caption}"><div class="kv-file-content">\n';et="<\/div>{footer}\n<\/div>\n";ot="{content}\n";st='<div class="kv-preview-data file-preview-html" title="{caption}" '+t.STYLE_SETTING+">{data}<\/div>\n";ht='<img src="{data}" class="file-preview-image kv-preview-data" title="{caption}" alt="{caption}" '+t.STYLE_SETTING+">\n";ct='<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly '+t.STYLE_SETTING+">{data}<\/textarea>\n";lt='<video class="kv-preview-data file-preview-video" width="{width}" height="{height}" controls>\n<source src="{data}" type="{type}">\n'+t.DEFAULT_PREVIEW+"\n<\/video>\n";at='<div class="file-preview-audio"><audio class="kv-preview-data" controls>\n<source src="{data}" type="{type}">\n'+t.DEFAULT_PREVIEW+"\n<\/audio><\/div>\n";vt='<object class="kv-preview-data file-object" type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+t.OBJECT_PARAMS+" "+t.DEFAULT_PREVIEW+"\n<\/object>\n";yt='<object class="kv-preview-data file-object {typeCss}" data="{data}" type="{type}" width="{width}" height="{height}">\n<param name="movie" value="{caption}" />\n'+t.OBJECT_PARAMS+" "+t.DEFAULT_PREVIEW+"\n<\/object>\n";pt='<embed class="kv-preview-data" src="{data}" width="{width}" height="{height}" type="application/pdf">\n';wt='<div class="kv-preview-data file-preview-other-frame">\n'+t.DEFAULT_PREVIEW+"\n<\/div>\n";bt='<div class="kv-zoom-cache" style="display:none">{zoomContent}<\/div>';r={width:"100%",height:"100%","min-height":"480px"};i.defaults={layoutTemplates:{main1:f,main2:e,preview:o,close:h,fileIcon:s,caption:c,modalMain:y,modal:p,progress:w,size:b,footer:k,indicator:rt,actions:d,actionDelete:g,actionUpload:nt,actionZoom:tt,actionDrag:it,btnDefault:l,btnLink:a,btnBrowse:v,zoomCache:bt},previewMarkupTags:{tagBefore1:ut,tagBefore2:ft,tagAfter:et},previewContentTemplates:{generic:ot,html:st,image:ht,text:ct,video:lt,audio:at,flash:vt,object:yt,pdf:pt,other:wt},allowedPreviewTypes:["image","html","text","video","audio","flash","pdf","object"],previewTemplates:{},previewSettings:{image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"100%","max-width":"100%"},object:{height:"100%"},pdf:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:r,text:r,video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%","max-width":"100%","min-height":"480px"},pdf:r,other:{width:"auto",height:"100%","min-height":"480px"}},fileTypeSettings:{image:function(n,i){return t.compare(n,"image.*")||t.compare(i,/\.(gif|png|jpe?g)$/i)},html:function(n,i){return t.compare(n,"text/html")||t.compare(i,/\.(htm|html)$/i)},text:function(n,i){return t.compare(n,"text.*")||t.compare(i,/\.(xml|javascript)$/i)||t.compare(i,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(n,i){return t.compare(n,"video.*")&&(t.compare(n,/(ogg|mp4|mp?g|mov|webm|3gp)$/i)||t.compare(i,/\.(og?|mp4|webm|mp?g|mov|3gp)$/i))},audio:function(n,i){return t.compare(n,"audio.*")&&(t.compare(i,/(ogg|mp3|mp?g|wav)$/i)||t.compare(i,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(n,i){return t.compare(n,"application/x-shockwave-flash",!0)||t.compare(i,/\.(swf)$/i)},pdf:function(n,i){return t.compare(n,"application/pdf",!0)||t.compare(i,/\.(pdf)$/i)},object:function(){return!0},other:function(){return!0}},fileActionSettings:{showRemove:!0,showUpload:!0,showZoom:!0,showDrag:!0,removeIcon:'<i class="glyphicon glyphicon-trash text-danger"><\/i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"><\/i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",zoomIcon:'<i class="glyphicon glyphicon-zoom-in"><\/i>',zoomClass:"btn btn-xs btn-default",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-menu-hamburger"><\/i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"><\/i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"><\/i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"><\/i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"><\/i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."}};n.each(i.defaults,function(t,r){return"allowedPreviewTypes"===t?void(void 0===i.allowedPreviewTypes&&(i.allowedPreviewTypes=r)):void(i[t]=n.extend(!0,{},r,i[t]))});i._initPreviewTemplates()},_initPreviewTemplates:function(){var r,i=this,f=i.defaults,u=i.previewMarkupTags,e=u.tagAfter;n.each(f.previewContentTemplates,function(n,f){t.isEmpty(i.previewTemplates[n])&&(r=u.tagBefore2,"generic"!==n&&"image"!==n&&"html"!==n&&"text"!==n||(r=u.tagBefore1),i.previewTemplates[n]=r+f+e)})},_initPreviewCache:function(){var i=this;i.previewCache={data:{},init:function(){var n=i.initialPreview;n.length>0&&!t.isArray(n)&&(n=n.split(i.initialPreviewDelimiter));i.previewCache.data={content:n,config:i.initialPreviewConfig,tags:i.initialPreviewThumbTags}},fetch:function(){return i.previewCache.data.content.filter(function(n){return null!==n})},count:function(n){return i.previewCache.data&&i.previewCache.data.content?n?i.previewCache.data.content.length:i.previewCache.fetch().length:0},get:function(r,u){var e,s,h,c,l,a,v,y="init_"+r,o=i.previewCache.data,f=o.config[r],p=o.content[r],w=i.previewInitId+"-"+y,k=t.ifSet("previewAsData",f,i.initialPreviewAsData),b=function(n,r,u,f,e,o,s,h,c){return h=" file-preview-initial "+t.SORT_CSS+(h?" "+h:""),i._generatePreviewTemplate(n,r,u,f,e,!1,null,h,o,s,c)};return p?(u=void 0===u?!0:u,h=t.ifSet("type",f,i.initialPreviewFileType||"generic"),l=t.ifSet("filename",f,t.ifSet("caption",f)),a=t.ifSet("filetype",f,h),c=i.previewCache.footer(r,u,f&&f.size||null),v=t.ifSet("frameClass",f),e=k?b(h,p,l,a,w,c,y,v):b("generic",p,l,a,w,c,y,v,h).setTokens({content:o.content[r]}),o.tags.length&&o.tags[r]&&(e=t.replaceTags(e,o.tags[r])),t.isEmpty(f)||t.isEmpty(f.frameAttr)||(s=n(document.createElement("div")).html(e),s.find(".file-preview-initial").attr(f.frameAttr),e=s.html(),s.remove()),e):""},add:function(n,r,u,f){var o,e=i.previewCache.data;return t.isArray(n)||(n=n.split(i.initialPreviewDelimiter)),f?(o=e.content.push(n)-1,e.config[o]=r,e.tags[o]=u):(o=n.length-1,e.content=n,e.config=r,e.tags=u),i.previewCache.data=e,o},set:function(n,r,u,f){var e,s,o=i.previewCache.data;if(n&&n.length&&(t.isArray(n)||(n=n.split(i.initialPreviewDelimiter)),s=n.filter(function(n){return null!==n}),s.length)){if(void 0===o.content&&(o.content=[]),void 0===o.config&&(o.config=[]),void 0===o.tags&&(o.tags=[]),f){for(e=0;e<n.length;e++)n[e]&&o.content.push(n[e]);for(e=0;e<r.length;e++)r[e]&&o.config.push(r[e]);for(e=0;e<u.length;e++)u[e]&&o.tags.push(u[e])}else o.content=n,o.config=r,o.tags=u;i.previewCache.data=o}},unset:function(n){var t=i.previewCache.count();if(t){if(1===t)return i.previewCache.data.content=[],i.previewCache.data.config=[],i.previewCache.data.tags=[],i.initialPreview=[],i.initialPreviewConfig=[],void(i.initialPreviewThumbTags=[]);i.previewCache.data.content[n]=null;i.previewCache.data.config[n]=null;i.previewCache.data.tags[n]=null}},out:function(){var t,n,r="",u=i.previewCache.count(!0);if(0===u)return{content:"",caption:""};for(n=0;u>n;n++)r+=i.previewCache.get(n);return t=i._getMsgSelected(i.previewCache.count()),{content:r,caption:t}},footer:function(n,r,u){var e=i.previewCache.data;if(!e||!e.config||0===e.config.length||t.isEmpty(e.config[n]))return"";r=void 0===r?!0:r;var s,f=e.config[n],c=t.ifSet("caption",f),l=t.ifSet("width",f,"auto"),h=t.ifSet("url",f,!1),a=t.ifSet("key",f,null),o=i.fileActionSettings,v=i.initialPreviewShowDelete||!1,y=t.ifSet("showDelete",f,t.ifSet("showDelete",o,v)),p=t.ifSet("showZoom",f,t.ifSet("showZoom",o,!0)),w=t.ifSet("showDrag",f,t.ifSet("showDrag",o,!0)),b=h===!1&&r;return s=i._renderFileActions(!1,y,p,w,b,h,a,!0),i._getLayoutTemplate("footer").setTokens({progress:i._renderThumbProgress(),actions:s,caption:c,size:i._getSize(u),width:l,indicator:""})}};i.previewCache.init()},_handler:function(n,t,i){var f=this,r=f.namespace,u=t.split(" ").join(r+" ")+r;n&&n.length&&n.off(u).on(u,i)},_log:function(n){var i=this,t=i.$element.attr("id");t&&(n='"'+t+'": '+n);"undefined"!=typeof window.console.log?window.console.log(n):window.alert(n)},_validate:function(){var n=this,t="file"===n.$element.attr("type");return t||n._log('The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.'),t},_errorsExist:function(){var t,i=this;return i.$errorContainer.find("li").length?!0:(t=n(document.createElement("div")).html(i.$errorContainer.html()),t.find("span.kv-error-close").remove(),t.find("ul").remove(),!!n.trim(t.text()).length)},_errorHandler:function(n,t){var r=this,i=n.target.error,u=function(n){r._showError(n.replace("{name}",t))};u(i.code===i.NOT_FOUND_ERR?r.msgFileNotFound:i.code===i.SECURITY_ERR?r.msgFileSecured:i.code===i.NOT_READABLE_ERR?r.msgFileNotReadable:i.code===i.ABORT_ERR?r.msgFilePreviewAborted:r.msgFilePreviewError)},_addError:function(n){var i=this,t=i.$errorContainer;n&&t.length&&(t.html(i.errorCloseButton+n),i._handler(t.find(".kv-error-close"),"click",function(){t.fadeOut("slow")}))},_resetErrors:function(n){var t=this,i=t.$errorContainer;t.isError=!1;t.$container.removeClass("has-error");i.html("");n?i.fadeOut("slow"):i.hide()},_showFolderError:function(n){var r,i=this,u=i.$errorContainer;n&&(r=i.msgFoldersNotAllowed.replace("{n}",n),i._addError(r),t.addCss(i.$container,"has-error"),u.fadeIn(800),i._raise("filefoldererror",[n,r]))},_showUploadError:function(n,i,r){var u=this,f=u.$errorContainer,o=r||"fileuploaderror",e=i&&i.id?'<li data-file-id="'+i.id+'">'+n+"<\/li>":"<li>"+n+"<\/li>";return 0===f.find("ul").length?u._addError("<ul>"+e+"<\/ul>"):f.find("ul").append(e),f.fadeIn(800),u._raise(o,[i,n]),u.$container.removeClass("file-input-new"),t.addCss(u.$container,"has-error"),!0},_showError:function(n,i,r){var u=this,f=u.$errorContainer,e=r||"fileerror";return i=i||{},i.reader=u.reader,u._addError(n),f.fadeIn(800),u._raise(e,[i,n]),u.isUploadable||u._clearFileInput(),u.$container.removeClass("file-input-new"),t.addCss(u.$container,"has-error"),u.$btnUpload.attr("disabled",!0),!0},_noFilesError:function(n){var i=this,u=i.minFileCount>1?i.filePlural:i.fileSingle,r=i.msgFilesTooLess.replace("{n}",i.minFileCount).replace("{files}",u),f=i.$errorContainer;i._addError(r);i.isError=!0;i._updateFileDetails(0);f.fadeIn(800);i._raise("fileerror",[n,r]);i._clearFileInput();t.addCss(i.$container,"has-error")},_parseError:function(t,i,r,u){var o=this,f=n.trim(r+""),s="."===f.slice(-1)?"":".",e=void 0!==i.responseJSON&&void 0!==i.responseJSON.error?i.responseJSON.error:i.responseText;return o.cancelling&&o.msgUploadAborted&&(f=o.msgUploadAborted),o.showAjaxErrorDetails&&e?(e=n.trim(e.replace(/\n\s*\n/g,"\n")),e=e.length>0?"<pre>"+e+"<\/pre>":"",f+=s+e):f+=s,f===s&&(f=o.msgAjaxError.replace("{operation}",t)),o.cancelling=!1,u?"<b>"+u+": <\/b>"+f:f},_parseFileType:function(n){for(var f,r,u,e=this,o=e.allowedPreviewTypes||[],i=0;i<o.length;i++)if(u=o[i],f=e.fileTypeSettings[u],r=f(n.type,n.name)?u:"",!t.isEmpty(r))return r;return"other"},_getPreviewIcon:function(t){var r,i=this,u=null;return t&&t.indexOf(".")>-1&&(r=t.split(".").pop(),i.previewFileIconSettings&&(u=i.previewFileIconSettings[r]||i.previewFileIconSettings[r.toLowerCase()]||null),i.previewFileExtSettings&&n.each(i.previewFileExtSettings,function(n,t){i.previewFileIconSettings[n]&&t(r)})),u},_parseFilePreviewIcon:function(n,t){var r=this,u=r._getPreviewIcon(t)||r.previewFileIcon,i=n;return i.indexOf("{previewFileIcon}")>-1&&(i=i.setTokens({previewFileIconClass:r.previewFileIconClass,previewFileIcon:u})),i},_raise:function(t,i){var u=this,r=n.Event(t);if(void 0!==i?u.$element.trigger(r,i):u.$element.trigger(r),r.isDefaultPrevented()||r.result===!1)return!1;switch(t){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:u.ajaxAborted||(u.ajaxAborted=r.result)}return!0},_listenFullScreen:function(n){var r,i,u=this,t=u.$modal;t&&t.length&&(r=t&&t.find(".btn-fullscreen"),i=t&&t.find(".btn-borderless"),r.length&&i.length&&(r.removeClass("active").attr("aria-pressed","false"),i.removeClass("active").attr("aria-pressed","false"),n?r.addClass("active").attr("aria-pressed","true"):i.addClass("active").attr("aria-pressed","true"),t.hasClass("file-zoom-fullscreen")?u._maximizeZoomDialog():n?u._maximizeZoomDialog():i.removeClass("active").attr("aria-pressed","false")))},_listen:function(){var r,i=this,e=i.$element,u=i.$form,f=i.$container;i._handler(e,"change",n.proxy(i._change,i));i.showBrowse&&i._handler(i.$btnFile,"click",n.proxy(i._browse,i));i._handler(f.find(".fileinput-remove:not([disabled])"),"click",n.proxy(i.clear,i));i._handler(f.find(".fileinput-cancel"),"click",n.proxy(i.cancel,i));i._initDragDrop();i._handler(u,"reset",n.proxy(i.reset,i));i.isUploadable||i._handler(u,"submit",n.proxy(i._submitForm,i));i._handler(i.$container.find(".fileinput-upload"),"click",n.proxy(i._uploadClick,i));i._handler(n(window),"resize",function(){i._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)});r="webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange";i._handler(n(document),r,function(){i._listenFullScreen(t.checkFullScreen())});i._initClickable()},_initClickable:function(){var r,i=this;i.isClickable&&(r=i.isUploadable?i.$dropZone:i.$preview.find(".file-default-preview"),t.addCss(r,"clickable"),r.attr("tabindex",-1),i._handler(r,"click",function(t){var u=n(t.target);u.parents(".file-preview-thumbnails").length&&!u.parents(".file-default-preview").length||(i.$element.trigger("click"),r.blur())}))},_initDragDrop:function(){var t=this,i=t.$dropZone;t.isUploadable&&t.dropZoneEnabled&&t.showPreview&&(t._handler(i,"dragenter dragover",n.proxy(t._zoneDragEnter,t)),t._handler(i,"dragleave",n.proxy(t._zoneDragLeave,t)),t._handler(i,"drop",n.proxy(t._zoneDrop,t)),t._handler(n(document),"dragenter dragover drop",t._zoneDragDropInit))},_zoneDragDropInit:function(n){n.stopPropagation();n.preventDefault()},_zoneDragEnter:function(i){var r=this,u=n.inArray("Files",i.originalEvent.dataTransfer.types)>-1;return r._zoneDragDropInit(i),r.isDisabled||!u?(i.originalEvent.dataTransfer.effectAllowed="none",void(i.originalEvent.dataTransfer.dropEffect="none")):void t.addCss(r.$dropZone,"file-highlighted")},_zoneDragLeave:function(n){var t=this;t._zoneDragDropInit(n);t.isDisabled||t.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(n){var i=this;n.preventDefault();i.isDisabled||t.isEmpty(n.originalEvent.dataTransfer.files)||(i._change(n,"dragdrop"),i.$dropZone.removeClass("file-highlighted"))},_uploadClick:function(n){var r,u=this,i=u.$container.find(".fileinput-upload"),f=!i.hasClass("disabled")&&t.isEmpty(i.attr("disabled"));if(!n||!n.isDefaultPrevented()){if(!u.isUploadable)return void(f&&"submit"!==i.attr("type")&&(r=i.closest("form"),r.length&&r.trigger("submit"),n.preventDefault()));n.preventDefault();f&&u.upload()}},_submitForm:function(){var n=this;return n._isFileSelectionValid()&&!n._abort({})},_clearPreview:function(){var i=this,r=i.$preview,u=i.showUploadedThumbs?i.getFrames(":not(.file-preview-success)"):i.getFrames();u.each(function(){var i=n(this);i.remove();t.cleanZoomCache(r.find("#zoom-"+i.attr("id")))});i.getFrames().length&&i.showPreview||i._resetUpload();i._validateDefaultPreview()},_initSortable:function(){var u,i=this,r=i.$preview,f="."+t.SORT_CSS;window.KvSortable&&0!==r.find(f).length&&(u={handle:".drag-handle-init",dataIdAttr:"data-preview-id",scroll:!1,draggable:f,onSort:function(r){var o,s,f=r.oldIndex,e=r.newIndex,u;for(i.initialPreview=t.moveArray(i.initialPreview,f,e),i.initialPreviewConfig=t.moveArray(i.initialPreviewConfig,f,e),i.previewCache.init(),u=0;u<i.initialPreviewConfig.length;u++)null!==i.initialPreviewConfig[u]&&(o=i.initialPreviewConfig[u].key,s=n(".kv-file-remove[data-key='"+o+"']").closest(t.FRAMES),s.attr("data-fileindex","init_"+u).attr("data-fileindex","init_"+u));i._raise("filesorted",{previewId:n(r.item).attr("id"),oldIndex:f,newIndex:e,stack:i.initialPreviewConfig})}},r.data("kvsortable")&&r.kvsortable("destroy"),n.extend(!0,u,i.fileActionSettings.dragSettings),r.kvsortable(u))},_initPreview:function(n){var r,i=this,u=i.initialCaption||"";return i.previewCache.count()?(r=i.previewCache.out(),u=n&&i.initialCaption?i.initialCaption:r.caption,i.$preview.html(r.content),i._setInitThumbAttr(),i._setCaption(u),i._initSortable(),void(t.isEmpty(r.content)||i.$container.removeClass("file-input-new"))):(i._clearPreview(),void(n?i._setCaption(u):i._initCaption()))},_getZoomButton:function(n){var t=this,r=t.previewZoomButtonIcons[n],u=t.previewZoomButtonClasses[n],f=' title="'+(t.previewZoomButtonTitles[n]||"")+'" ',i=f+("close"===n?' data-dismiss="modal" aria-hidden="true"':"");return"fullscreen"!==n&&"borderless"!==n&&"toggleheader"!==n||(i+=' data-toggle="button" aria-pressed="false" autocomplete="off"'),'<button type="button" class="'+u+" btn-"+n+'"'+i+">"+r+"<\/button>"},_getModalContent:function(){var n=this;return n._getLayoutTemplate("modal").setTokens({rtl:n.rtl?" kv-rtl":"",zoomFrameClass:n.frameClass,heading:n.msgZoomModalHeading,prev:n._getZoomButton("prev"),next:n._getZoomButton("next"),toggleheader:n._getZoomButton("toggleheader"),fullscreen:n._getZoomButton("fullscreen"),borderless:n._getZoomButton("borderless"),close:n._getZoomButton("close")})},_listenModalEvent:function(n){var r=this,i=r.$modal,u=function(n){return{sourceEvent:n,previewId:i.data("previewId"),modal:i}};i.on(n+".bs.modal",function(f){var e=i.find(".btn-fullscreen"),o=i.find(".btn-borderless");r._raise("filezoom"+n,u(f));"shown"===n&&(o.removeClass("active").attr("aria-pressed","false"),e.removeClass("active").attr("aria-pressed","false"),i.hasClass("file-zoom-fullscreen")&&(r._maximizeZoomDialog(),t.checkFullScreen()?e.addClass("active").attr("aria-pressed","true"):o.addClass("active").attr("aria-pressed","true")))})},_initZoom:function(){var r,i=this,f=i._getLayoutTemplate("modalMain"),u="#"+t.MODAL_ID;i.showPreview&&(i.$modal=n(u),i.$modal&&i.$modal.length||(r=n(document.createElement("div")).html(f).insertAfter(i.$container),i.$modal=n(u).insertBefore(r),r.remove()),t.initModal(i.$modal),i.$modal.html(i._getModalContent()),n.each(t.MODAL_EVENTS,function(n,t){i._listenModalEvent(t)}))},_initZoomButtons:function(){var f,e,t=this,o=t.$modal.data("previewId")||"",i=t.getFrames().toArray(),s=i.length,r=t.$modal.find(".btn-prev"),u=t.$modal.find(".btn-next");return i.length<2?(r.hide(),void u.hide()):(r.show(),u.show(),void(s&&(f=n(i[0]),e=n(i[s-1]),r.removeAttr("disabled"),u.removeAttr("disabled"),f.length&&f.attr("id")===o&&r.attr("disabled",!0),e.length&&e.attr("id")===o&&u.attr("disabled",!0))))},_maximizeZoomDialog:function(){var o=this,t=o.$modal,u=t.find(".modal-header:visible"),f=t.find(".modal-footer:visible"),i=t.find(".modal-body"),r=n(window).height(),e=0;t.addClass("file-zoom-fullscreen");u&&u.length&&(r-=u.outerHeight(!0));f&&f.length&&(r-=f.outerHeight(!0));i&&i.length&&(e=i.outerHeight(!0)-i.height(),r-=e);t.find(".kv-zoom-body").height(r)},_resizeZoomDialog:function(n){var r=this,i=r.$modal,u=i.find(".btn-fullscreen"),f=i.find(".btn-borderless");if(i.hasClass("file-zoom-fullscreen"))t.toggleFullScreen(!1),n?u.hasClass("active")||(i.removeClass("file-zoom-fullscreen"),r._resizeZoomDialog(!0),f.hasClass("active")&&f.removeClass("active").attr("aria-pressed","false")):u.hasClass("active")?u.removeClass("active").attr("aria-pressed","false"):(i.removeClass("file-zoom-fullscreen"),r.$modal.find(".kv-zoom-body").css("height",r.zoomModalHeight));else{if(!n)return void r._maximizeZoomDialog();t.toggleFullScreen(!0)}i.focus()},_setZoomContent:function(i,r){var h,y,c,p,e,o,l,a,w,b,u=this,s=i.attr("id"),f=u.$modal,k=f.find(".btn-prev"),d=f.find(".btn-next"),nt=f.find(".btn-fullscreen"),tt=f.find(".btn-borderless"),it=f.find(".btn-toggleheader"),g=u.$preview.find("#zoom-"+s),v;y=g.attr("data-template")||"generic";h=g.find(".kv-file-content");c=h.length?h.html():"";w=i.data("caption")||"";b=i.data("size")||"";p=w+" "+b;f.find(".kv-zoom-title").html(p);e=f.find(".kv-zoom-body");f.removeClass("kv-single-content");r?(a=e.addClass("file-thumb-loading").clone().insertAfter(e),e.html(c).hide(),a.fadeOut("fast",function(){e.fadeIn("fast",function(){e.removeClass("file-thumb-loading")});a.remove()})):e.html(c);l=u.previewZoomSettings[y];l&&(o=e.find(".kv-preview-data"),t.addCss(o,"file-zoom-detail"),n.each(l,function(n,t){o.css(n,t);(o.attr("width")&&"width"===n||o.attr("height")&&"height"===n)&&o.removeAttr(n)}));f.data("previewId",s);v=e.find("img");v.length&&t.adjustOrientedImage(v,!0);u._handler(k,"click",function(){u._zoomSlideShow("prev",s)});u._handler(d,"click",function(){u._zoomSlideShow("next",s)});u._handler(nt,"click",function(){u._resizeZoomDialog(!0)});u._handler(tt,"click",function(){u._resizeZoomDialog(!1)});u._handler(it,"click",function(){var t,n=f.find(".modal-header"),i=f.find(".modal-body .floating-buttons"),r=n.find(".kv-zoom-actions"),e=function(t){var r=u.$modal.find(".kv-zoom-body"),i=u.zoomModalHeight;f.hasClass("file-zoom-fullscreen")&&(i=r.outerHeight(!0),t||(i-=n.outerHeight(!0)));r.css("height",t?i+t:i)};n.is(":visible")?(t=n.outerHeight(!0),n.slideUp("slow",function(){r.find(".btn").appendTo(i);e(t)})):(i.find(".btn").appendTo(r),n.slideDown("slow",function(){e()}));f.focus()});u._handler(f,"keydown",function(n){var t=n.which||n.keyCode;37!==t||k.attr("disabled")||u._zoomSlideShow("prev",s);39!==t||d.attr("disabled")||u._zoomSlideShow("next",s)})},_zoomPreview:function(n){var u,i=this,r=i.$modal;if(!n.length)throw"Cannot zoom to detailed preview!";t.initModal(r);r.html(i._getModalContent());u=n.closest(t.FRAMES);i._setZoomContent(u);r.modal("show");i._initZoomButtons()},_zoomSlideShow:function(t,i){var o,r,f,u=this,h=u.$modal.find(".kv-zoom-actions .btn-"+t),e=u.getFrames().toArray(),s=e.length;if(!h.attr("disabled")){for(r=0;s>r;r++)if(n(e[r]).attr("id")===i){f="prev"===t?r-1:r+1;break}0>f||f>=s||!e[f]||(o=n(e[f]),o.length&&u._setZoomContent(o,!0),u._initZoomButtons(),u._raise("filezoom"+t,{previewId:i,modal:u.$modal}))}},_initZoomButton:function(){var t=this;t.$preview.find(".kv-file-zoom").each(function(){var i=n(this);t._handler(i,"click",function(){t._zoomPreview(i)})})},_clearObjects:function(t){t.find("video audio").each(function(){this.pause();n(this).remove()});t.find("img object div").each(function(){n(this).remove()})},_clearFileInput:function(){var e,r,u,f=this,i=f.$element;f.fileInputCleared=!0;t.isEmpty(i.val())||(f.isIE9||f.isIE10?(e=i.closest("form"),r=n(document.createElement("form")),u=n(document.createElement("div")),i.before(u),e.length?e.after(r):u.after(r),r.append(i).trigger("reset"),u.before(i).remove(),r.remove()):i.val(""))},_resetUpload:function(){var n=this;n.uploadCache={content:[],config:[],tags:[],append:!0};n.uploadCount=0;n.uploadStatus={};n.uploadLog=[];n.uploadAsyncCount=0;n.loadedImages=[];n.totalImagesCount=0;n.$btnUpload.removeAttr("disabled");n._setProgress(0);t.addCss(n.$progress,"hide");n._resetErrors(!1);n.ajaxAborted=!1;n.ajaxRequests=[];n._resetCanvas();n.cacheInitialPreview={};n.overwriteInitial&&(n.initialPreview=[],n.initialPreviewConfig=[],n.initialPreviewThumbTags=[],n.previewCache.data={content:[],config:[],tags:[]})},_resetCanvas:function(){var n=this;n.canvas&&n.imageCanvasContext&&n.imageCanvasContext.clearRect(0,0,n.canvas.width,n.canvas.height)},_hasInitialPreview:function(){var n=this;return!n.overwriteInitial&&n.previewCache.count()},_resetPreview:function(){var t,i,n=this;n.previewCache.count()?(t=n.previewCache.out(),n.$preview.html(t.content),n._setInitThumbAttr(),i=n.initialCaption?n.initialCaption:t.caption,n._setCaption(i)):(n._clearPreview(),n._initCaption());n.showPreview&&(n._initZoom(),n._initSortable())},_clearDefaultPreview:function(){var n=this;n.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){var n=this;n.showPreview&&!t.isEmpty(n.defaultPreviewContent)&&(n.$preview.html('<div class="file-default-preview">'+n.defaultPreviewContent+"<\/div>"),n.$container.removeClass("file-input-new"),n._initClickable())},_resetPreviewThumbs:function(n){var i,t=this;return n?(t._clearPreview(),void t.clearStack()):void(t._hasInitialPreview()?(i=t.previewCache.out(),t.$preview.html(i.content),t._setInitThumbAttr(),t._setCaption(i.caption),t._initPreviewActions()):t._clearPreview())},_getLayoutTemplate:function(n){var i=this,r=i.layoutTemplates[n];return t.isEmpty(i.customLayoutTags)?r:t.replaceTags(r,i.customLayoutTags)},_getPreviewTemplate:function(n){var i=this,r=i.previewTemplates[n];return t.isEmpty(i.customPreviewTags)?r:t.replaceTags(r,i.customPreviewTags)},_getOutData:function(n,t,i){var r=this;return n=n||{},t=t||{},i=i||r.filestack.slice(0)||{},{form:r.formdata,files:i,filenames:r.filenames,filescount:r.getFilesCount(),extra:r._getExtraData(),response:t,reader:r.reader,jqXHR:n}},_getMsgSelected:function(n){var t=this,i=1===n?t.fileSingle:t.filePlural;return n>0?t.msgSelected.replace("{n}",n).replace("{files}",i):t.msgNoFilesSelected},_getFrame:function(t){var r=this,i=n("#"+t);return i.length?i:(r._log('Invalid thumb frame with id: "'+t+'".'),null)},_getThumbs:function(n){return n=n||"",this.getFrames(":not(.file-preview-initial)"+n)},_getExtraData:function(n,t){var i=this,r=i.uploadExtraData;return"function"==typeof i.uploadExtraData&&(r=i.uploadExtraData(n,t)),r},_initXhr:function(n,t,i){var r=this;return n.upload&&n.upload.addEventListener("progress",function(n){var u=0,f=n.total,e=n.loaded||n.position;n.lengthComputable&&(u=Math.floor(e/f*100));t?r._setAsyncUploadStatus(t,u,i):r._setProgress(u)},!1),n},_ajaxSubmit:function(t,i,r,u,f,e){var s,o=this;o._raise("filepreajax",[f,e])&&(o._uploadExtra(f,e),s=n.extend(!0,{},{xhr:function(){var t=n.ajaxSettings.xhr();return o._initXhr(t,f,o.getFileStack().length)},url:o.uploadUrl,type:"POST",dataType:"json",data:o.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:t,success:i,complete:r,error:u},o.ajaxSettings),o.ajaxRequests.push(n.ajax(s)))},_mergeArray:function(n,i){var r=this,u=t.cleanArray(r[n]),f=t.cleanArray(i);r[n]=u.concat(f)},_initUploadSuccess:function(i,r,u){var h,v,y,c,l,e,o,s,a,f=this;f.showPreview&&"object"==typeof i&&!n.isEmptyObject(i)&&void 0!==i.initialPreview&&i.initialPreview.length>0&&(f.hasInitData=!0,e=i.initialPreview||[],o=i.initialPreviewConfig||[],s=i.initialPreviewThumbTags||[],h=!(void 0!==i.append&&!i.append),e.length>0&&!t.isArray(e)&&(e=e.split(f.initialPreviewDelimiter)),f._mergeArray("initialPreview",e),f._mergeArray("initialPreviewConfig",o),f._mergeArray("initialPreviewThumbTags",s),void 0!==r?u?(a=r.attr("data-fileindex"),f.uploadCache.content[a]=e[0],f.uploadCache.config[a]=o[0]||[],f.uploadCache.tags[a]=s[0]||[],f.uploadCache.append=h):(y=f.previewCache.add(e,o[0],s[0],h),v=f.previewCache.get(y,!1),c=n(document.createElement("div")).html(v).hide().insertAfter(r),l=c.find(".kv-zoom-cache"),l&&l.length&&l.insertAfter(r),r.fadeOut("slow",function(){var n=c.find(".file-preview-frame");n&&n.length&&n.insertBefore(r).fadeIn("slow").css("display:inline-block");f._initPreviewActions();f._clearFileInput();t.cleanZoomCache(f.$preview.find("#zoom-"+r.attr("id")));r.remove();c.remove();f._initSortable()})):(f.previewCache.set(e,o,s,h),f._initPreview(),f._initPreviewActions()))},_initSuccessThumbs:function(){var i=this;i.showPreview&&i._getThumbs(t.FRAMES+".file-preview-success").each(function(){var r=n(this),f=i.$preview,u=r.find(".kv-file-remove");u.removeAttr("disabled");i._handler(u,"click",function(){var n=r.attr("id"),u=i._raise("filesuccessremove",[n,r.attr("data-fileindex")]);t.cleanMemory(r);u!==!1&&r.fadeOut("slow",function(){t.cleanZoomCache(f.find("#zoom-"+n));r.remove();i.getFrames().length||i.reset()})})})},_checkAsyncComplete:function(){for(var r,t=this,i=0;i<t.filestack.length;i++)if(t.filestack[i]&&(r=t.previewInitId+"-"+i,-1===n.inArray(r,t.uploadLog)))return!1;return t.uploadAsyncCount===t.uploadLog.length},_uploadExtra:function(t,i){var r=this,u=r._getExtraData(t,i);0!==u.length&&n.each(u,function(n,t){r.formdata.append(n,t)})},_uploadSingle:function(i,r,u){var h,e,b,c,y,k,d,g,nt,l,a,f=this,tt=f.getFileStack().length,p=new FormData,o=f.previewInitId+"-"+i,it=f.filestack.length>0||!n.isEmptyObject(f.uploadExtraData),w=n("#"+o).find(".file-thumb-progress"),s={id:o,index:i},v=!t.isEmpty(f.$element.attr("multiple"));f.formdata=p;f.showPreview&&(e=n("#"+o+":not(.file-preview-initial)"),c=e.find(".kv-file-upload"),y=e.find(".kv-file-remove"),w.removeClass("hide"));0===tt||!it||c&&c.hasClass("disabled")||f._abort(s)||(l=function(n,t){!v&&a||f.updateStack(n,void 0);f.uploadLog.push(t);f._checkAsyncComplete()&&(f.fileBatchCompleted=!0)},b=function(){var e,r,u,n=f.uploadCache,o=0,i=f.cacheInitialPreview;f.fileBatchCompleted&&(i&&i.content&&(o=i.content.length),setTimeout(function(){var s=v||!a;if(f.showPreview){if(f.previewCache.set(n.content,n.config,n.tags,n.append),o){for(r=0;r<n.content.length;r++)u=r+o,i.content[u]=n.content[r],i.config.length&&(i.config[u]=n.config[r]),i.tags.length&&(i.tags[u]=n.tags[r]);f.initialPreview=t.cleanArray(i.content);f.initialPreviewConfig=t.cleanArray(i.config);f.initialPreviewThumbTags=t.cleanArray(i.tags)}else f.initialPreview=n.content,f.initialPreviewConfig=n.config,f.initialPreviewThumbTags=n.tags;f.cacheInitialPreview={};f.hasInitData&&(f._initPreview(),f._initPreviewActions())}f.unlock(s);s&&f._clearFileInput();e=f.$preview.find(".file-preview-initial");f.uploadAsync&&e.length&&(t.addCss(e,t.SORT_CSS),f._initSortable());f._raise("filebatchuploadcomplete",[f.filestack,f._getExtraData()]);f.uploadCount=0;f.uploadStatus={};f.uploadLog=[];f._setProgress(101)},100))},k=function(r){h=f._getOutData(r);f.fileBatchCompleted=!1;f.showPreview&&(e.hasClass("file-preview-success")||(f._setThumbStatus(e,"Loading"),t.addCss(e,"file-uploading")),c.attr("disabled",!0),y.attr("disabled",!0));u||f.lock();f._raise("filepreupload",[h,o,i]);n.extend(!0,s,h);f._abort(s)&&(r.abort(),f._setProgressCancelled())},d=function(r,y,p){var b=f.showPreview&&e.attr("id")?e.attr("id"):o;h=f._getOutData(p,r);n.extend(!0,s,h);setTimeout(function(){t.isEmpty(r)||t.isEmpty(r.error)?(f.showPreview&&(f._setThumbStatus(e,"Success"),c.hide(),f._initUploadSuccess(r,e,u),f._setProgress(101,w)),f._raise("fileuploaded",[h,b,i]),u?l(i,b):f.updateStack(i,void 0)):(a=!0,f._showUploadError(r.error,s),f._setPreviewError(e,i,v?null:f.filestack[i]),u&&l(i,b))},100)},g=function(){setTimeout(function(){f.showPreview&&(c.removeAttr("disabled"),y.removeAttr("disabled"),e.removeClass("file-uploading"));u?b():(f.unlock(!1),f._clearFileInput());f._initSuccessThumbs()},100)},nt=function(t,h,c){var y=f.ajaxOperations.uploadThumb,p=f._parseError(y,t,c,u?r[i].name:null);a=!0;setTimeout(function(){u&&l(i,o);f.uploadStatus[o]=100;f._setPreviewError(e,i,v?null:f.filestack[i]);n.extend(!0,s,f._getOutData(t));f._setProgress(101,w,f.msgAjaxProgressError.replace("{operation}",y));f._showUploadError(p,s)},100)},p.append(f.uploadFileAttr,r[i],f.filenames[i]),p.append("file_id",i),f._ajaxSubmit(k,d,g,nt,o,i))},_uploadBatch:function(){var u,f,e,o,s,i=this,r=i.filestack,h=r.length,c=i.filestack.length>0||!n.isEmptyObject(i.uploadExtraData);i.formdata=new FormData;0!==h&&c&&!i._abort({})&&(s=function(){n.each(r,function(n){i.updateStack(n,void 0)});i._clearFileInput()},u=function(r){i.lock();var u=i._getOutData(r);i.showPreview&&i._getThumbs().each(function(){var r=n(this),u=r.find(".kv-file-upload"),f=r.find(".kv-file-remove");r.hasClass("file-preview-success")||(i._setThumbStatus(r,"Loading"),t.addCss(r,"file-uploading"));u.attr("disabled",!0);f.attr("disabled",!0)});i._raise("filebatchpreupload",[u]);i._abort(u)&&(r.abort(),i._setProgressCancelled())},f=function(r,u,f){var o=i._getOutData(f,r),h=i._getThumbs(":not(.file-preview-error)"),e=0,c=t.isEmpty(r)||t.isEmpty(r.errorkeys)?[]:r.errorkeys;t.isEmpty(r)||t.isEmpty(r.error)?(i._raise("filebatchuploadsuccess",[o]),s(),i.showPreview?(h.each(function(){var t=n(this),r=t.find(".kv-file-upload");t.find(".kv-file-upload").hide();i._setThumbStatus(t,"Success");t.removeClass("file-uploading");r.removeAttr("disabled")}),i._initUploadSuccess(r)):i.reset(),i._setProgress(101)):(i.showPreview&&(h.each(function(){var t=n(this),r=t.find(".kv-file-remove"),u=t.find(".kv-file-upload");return t.removeClass("file-uploading"),u.removeAttr("disabled"),r.removeAttr("disabled"),0===c.length?void i._setPreviewError(t):(-1!==n.inArray(e,c)?i._setPreviewError(t):(t.find(".kv-file-upload").hide(),i._setThumbStatus(t,"Success"),i.updateStack(e,void 0)),void e++)}),i._initUploadSuccess(r)),i._showUploadError(r.error,o,"filebatchuploaderror"))},o=function(){i.unlock();i._initSuccessThumbs();i._clearFileInput();i._raise("filebatchuploadcomplete",[i.filestack,i._getExtraData()])},e=function(t,r,u){var e=i._getOutData(t),f=i.ajaxOperations.uploadBatch,o=i._parseError(f,t,u);i._showUploadError(o,e,"filebatchuploaderror");i.uploadFileCount=h-1;i.showPreview&&(i._getThumbs().each(function(){var t=n(this),r=t.attr("data-fileindex");t.removeClass("file-uploading");void 0!==i.filestack[r]&&i._setPreviewError(t)}),i._getThumbs().removeClass("file-uploading"),i._getThumbs(" .kv-file-upload").removeAttr("disabled"),i._getThumbs(" .kv-file-delete").removeAttr("disabled"),i._setProgress(101,i.$progress,i.msgAjaxProgressError.replace("{operation}",f)))},n.each(r,function(n,u){t.isEmpty(r[n])||i.formdata.append(i.uploadFileAttr,u,i.filenames[n])}),i._ajaxSubmit(u,f,o,e))},_uploadExtraOnly:function(){var r,u,f,e,n=this,i={};n.formdata=new FormData;n._abort(i)||(r=function(t){n.lock();var r=n._getOutData(t);n._raise("filebatchpreupload",[r]);n._setProgress(50);i.data=r;i.xhr=t;n._abort(i)&&(t.abort(),n._setProgressCancelled())},u=function(i,r,u){var f=n._getOutData(u,i);t.isEmpty(i)||t.isEmpty(i.error)?(n._raise("filebatchuploadsuccess",[f]),n._clearFileInput(),n._initUploadSuccess(i),n._setProgress(101)):n._showUploadError(i.error,f,"filebatchuploaderror")},f=function(){n.unlock();n._clearFileInput();n._raise("filebatchuploadcomplete",[n.filestack,n._getExtraData()])},e=function(t,r,u){var f=n._getOutData(t),e=n.ajaxOperations.uploadExtra,o=n._parseError(e,t,u);i.data=f;n._showUploadError(o,f,"filebatchuploaderror");n._setProgress(101,n.$progress,n.msgAjaxProgressError.replace("{operation}",e))},n._ajaxSubmit(r,u,f,e))},_deleteFileIndex:function(i){var r=this,u=i.attr("data-fileindex");"init_"===u.substring(0,5)&&(u=parseInt(u.replace("init_","")),r.initialPreview=t.spliceArray(r.initialPreview,u),r.initialPreviewConfig=t.spliceArray(r.initialPreviewConfig,u),r.initialPreviewThumbTags=t.spliceArray(r.initialPreviewThumbTags,u),r.getFrames().each(function(){var i=n(this),t=i.attr("data-fileindex");"init_"===t.substring(0,5)&&(t=parseInt(t.replace("init_","")),t>u&&(t--,i.attr("data-fileindex","init_"+t)))}),r.uploadAsync&&(r.cacheInitialPreview=r.getPreview()))},_initFileActions:function(){var i=this,r=i.$preview;i.showPreview&&(i._initZoomButton(),i.getFrames(" .kv-file-remove").each(function(){var s,e,h,c,l=n(this),u=l.closest(t.FRAMES),f=u.attr("id"),o=u.attr("data-fileindex");i._handler(l,"click",function(){return c=i._raise("filepreremove",[f,o]),c!==!1&&i._validateMinCount()?(s=u.hasClass("file-preview-error"),t.cleanMemory(u),void u.fadeOut("slow",function(){t.cleanZoomCache(r.find("#zoom-"+f));i.updateStack(o,void 0);i._clearObjects(u);u.remove();f&&s&&i.$errorContainer.find('li[data-file-id="'+f+'"]').fadeOut("fast",function(){n(this).remove();i._errorsExist()||i._resetErrors()});i._clearFileInput();var c=i.getFileStack(!0),l=i.previewCache.count(),a=c.length,v=i.showPreview&&i.getFrames().length;0!==a||0!==l||v?(e=l+a,h=e>1?i._getMsgSelected(e):c[0]?i._getFileNames()[0]:"",i._setCaption(h)):i.reset();i._raise("fileremoved",[f,o])})):!1})}),i.getFrames(" .kv-file-upload").each(function(){var r=n(this);i._handler(r,"click",function(){var n=r.closest(t.FRAMES),u=n.attr("data-fileindex");n.hasClass("file-preview-error")||i._uploadSingle(u,i.filestack,!1)})}))},_initPreviewActions:function(){var i=this,r=i.$preview,e=i.deleteExtraData||{},f=t.FRAMES+" .kv-file-remove",u=function(){var n=i.isUploadable?i.previewCache.count():i.$element.get(0).files.length;0!==r.find(f).length||n||(i.reset(),i.initialCaption="")};i._initZoomButton();r.find(f).each(function(){var s=n(this),y=s.data("url")||i.deleteUrl,l=s.data("key");if(!t.isEmpty(y)&&void 0!==l){var p,h,a,o,f=s.closest(t.FRAMES),v=i.previewCache.data,c=f.attr("data-fileindex");c=parseInt(c.replace("init_",""));a=t.isEmpty(v.config)&&t.isEmpty(v.config[c])?null:v.config[c];o=t.isEmpty(a)||t.isEmpty(a.extra)?e:a.extra;"function"==typeof o&&(o=o());h={id:s.attr("id"),key:l,extra:o};p=n.extend(!0,{},{url:y,type:"POST",dataType:"json",data:n.extend(!0,{},{key:l},o),beforeSend:function(n){i.ajaxAborted=!1;i._raise("filepredelete",[l,n,o]);i.ajaxAborted?n.abort():(t.addCss(f,"file-uploading"),t.addCss(s,"disabled"))},success:function(n,e,a){var v,y;return t.isEmpty(n)||t.isEmpty(n.error)?(c=parseInt(f.attr("data-fileindex").replace("init_","")),i.previewCache.unset(c),v=i.previewCache.count(),y=v>0?i._getMsgSelected(v):"",i._deleteFileIndex(f),i._setCaption(y),i._raise("filedeleted",[l,a,o]),f.removeClass("file-uploading").addClass("file-deleted"),void f.fadeOut("slow",function(){t.cleanZoomCache(r.find("#zoom-"+f.attr("id")));i._clearObjects(f);f.remove();u();v||0!==i.getFileStack().length||(i._setCaption(""),i.reset())})):(h.jqXHR=a,h.response=n,i._showError(n.error,h,"filedeleteerror"),f.removeClass("file-uploading"),s.removeClass("disabled"),void u())},error:function(n,t,r){var e=i.ajaxOperations.deleteThumb,o=i._parseError(e,n,r);h.jqXHR=n;h.response={};i._showError(o,h,"filedeleteerror");f.removeClass("file-uploading");u()}},i.ajaxDeleteSettings);i._handler(s,"click",function(){return i._validateMinCount()?void n.ajax(p):!1})}})},_hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},_showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},_getSize:function(t){var u,f,r,e=this,i=parseFloat(t),o=e.fileSizeGetter;return n.isNumeric(t)&&n.isNumeric(i)?("function"==typeof o?r=o(i):0===i?r="0.00 B":(u=Math.floor(Math.log(i)/Math.log(1024)),f=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],r=1*(i/Math.pow(1024,u)).toFixed(2)+" "+f[u]),e._getLayoutTemplate("size").replace("{sizeText}",r)):""},_generatePreviewTemplate:function(i,r,u,f,e,o,s,h,c,l,a){var b,v=this,k=v.slug(u),p="",y=v.previewSettings[i]||v.defaults.previewSettings[i],w=y&&y.width?y.width:"",tt=y&&y.height?y.height:"",it=c||v._renderFileFooter(k,s,t.isEmpty(w)?"auto":w,o),d=v._getPreviewIcon(u),g="type-default",rt=d&&v.preferIconicPreview,ut=d&&v.preferIconicZoomPreview,nt=function(r,o,s,c){var b=s?"zoom-"+e:e,p=v._getPreviewTemplate(r),y=(h||"")+" "+c;return v.frameClass&&(y=v.frameClass+" "+y),s&&(y=y.replace(" "+t.SORT_CSS,"")),p=v._parseFilePreviewIcon(p,u),"text"===r&&(o=t.htmlEncode(o)),"object"!==i||f||n.each(v.defaults.fileTypeSettings,function(n,t){"object"!==n&&"other"!==n&&t(u,f)&&(g="type-"+n)}),p.setTokens({previewId:b,caption:k,frameClass:y,type:f,fileindex:l,width:w,height:tt,typeCss:g,footer:it,data:o,template:a||i})};return l=l||e.slice(e.lastIndexOf("-")+1),v.fileActionSettings.showZoom&&(p=nt(ut?"other":i,r,!0,"kv-zoom-thumb")),p="\n"+v._getLayoutTemplate("zoomCache").replace("{zoomContent}",p),b=nt(rt?"other":i,r,!1,"kv-preview-thumb"),b+p},_previewDefault:function(i,r,u){var f=this,h=f.$preview;if(f.showPreview){var e,o=i?i.name:"",c=i?i.type:"",s=i.size||0,l=f.slug(o),a=u===!0&&!f.isUploadable,v=t.objUrl.createObjectURL(i);f._clearDefaultPreview();e=f._generatePreviewTemplate("other",v,o,c,r,a,s);h.append("\n"+e);f._setThumbAttr(r,l,s);u===!0&&f.isUploadable&&f._setThumbStatus(n("#"+r),"Error")}},_previewFile:function(n,i,r,u,f){var o;if(this.showPreview){var y,e=this,s=e._parseFileType(i),p=i?i.name:"",a=e.slug(p),w=e.allowedPreviewTypes,b=e.allowedPreviewMimeTypes,v=e.$preview,k=w&&w.indexOf(s)>=0,c=i.size||0,l=i.type,h="text"===s||"html"===s||"image"===s?r.target.result:f,d=b&&-1!==b.indexOf(l);("html"===s&&e.purifyHtml&&window.DOMPurify&&(h=window.DOMPurify.sanitize(h)),k||d)?(y=e._generatePreviewTemplate(s,h,p,l,u,!1,c),e._clearDefaultPreview(),v.append("\n"+y),o=v.find("#"+u+" img"),o.length&&e.autoOrientImage?t.validateOrientation(i,function(n){if(n){var f=v.find("#zoom-"+u+" img"),r="rotate-"+n;n>4&&(r+=o.width()>o.height()?" is-portrait-gt4":" is-landscape-gt4");t.addCss(o,r);t.addCss(f,r);e._raise("fileimageoriented",{$img:o,file:i})}e._validateImage(u,a,l,c,h);t.adjustOrientedImage(o)}):e._validateImage(u,a,l,c,h)):e._previewDefault(i,u);e._setThumbAttr(u,a,c);e._initSortable()}},_setThumbAttr:function(t,i,r){var f=this,u=n("#"+t);u.length&&(r=r&&r>0?f._getSize(r):"",u.data({caption:i,size:r}))},_setInitThumbAttr:function(){var i,u,f,e,r=this,s=r.previewCache.data,o=r.previewCache.count(!0),n;if(0!==o)for(n=0;o>n;n++)i=s.config[n],e=r.previewInitId+"-init_"+n,u=t.ifSet("caption",i,t.ifSet("filename",i)),f=t.ifSet("size",i),r._setThumbAttr(e,u,f)},_slugDefault:function(n){return t.isEmpty(n)?"":String(n).replace(/[\-\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_readFiles:function(i){this.reader=new FileReader;var e,r=this,b=r.$element,y=r.$preview,u=r.reader,l=r.$previewContainer,c=r.$previewStatus,k=r.msgLoading,p=r.msgProgress,d=r.previewInitId,f=i.length,a=r.fileTypeSettings,g=r.filestack.length,o=r.allowedFileTypes,w=o?o.length:0,s=r.allowedFileExtensions,nt=t.isEmpty(s)?"":s.join(", "),v=r.maxFilePreviewSize&&parseFloat(r.maxFilePreviewSize),tt=y.length&&(!v||isNaN(v)),h=function(t,u,f,o){var s=n.extend(!0,{},r._getOutData({},{},i),{id:f,index:o}),h={id:f,index:o,file:u,files:i};return r._previewDefault(u,f,!0),r.isUploadable&&(r.addToStack(void 0),setTimeout(function(){e(o+1)},100)),r._initFileActions(),r.removeFromPreviewOnError&&n("#"+f).remove(),r.isUploadable?r._showUploadError(t,s):r._showError(t,h)};r.loadedImages=[];r.totalImagesCount=0;n.each(i,function(n,t){var i=r.fileTypeSettings.image;i&&i(t.type)&&r.totalImagesCount++});e=function(n){if(t.isEmpty(b.attr("multiple"))&&(f=1),n>=f)return r.isUploadable&&r.filestack.length>0?r._raise("filebatchselected",[r.getFileStack()]):r._raise("filebatchselected",[i]),l.removeClass("file-thumb-loading"),void c.html("");var pt,wt,ct,et,rt,bt,lt,at,vt,st,dt=g+n,ft=d+"-"+dt,it=i[n],ut=it.name?r.slug(it.name):"",ht=(it.size||0)/1e3,yt="",gt=t.objUrl.createObjectURL(it),ot=0,kt="";if(w>0)for(et=0;w>et;et++)at=o[et],vt=r.msgFileTypes[at]||at,kt+=0===et?vt:", "+vt;if(ut===!1)return void e(n+1);if(0===ut.length)return rt=r.msgInvalidFileName.replace("{name}",t.htmlEncode(it.name)),void(r.isError=h(rt,it,ft,n));if(t.isEmpty(s)||(yt=new RegExp("\\.("+s.join("|")+")$","i")),ct=ht.toFixed(2),r.maxFileSize>0&&ht>r.maxFileSize)return rt=r.msgSizeTooLarge.setTokens({name:ut,size:ct,maxSize:r.maxFileSize}),void(r.isError=h(rt,it,ft,n));if(null!==r.minFileSize&&ht<=t.getNum(r.minFileSize))return rt=r.msgSizeTooSmall.setTokens({name:ut,size:ct,minSize:r.minFileSize}),void(r.isError=h(rt,it,ft,n));if(!t.isEmpty(o)&&t.isArray(o)){for(et=0;et<o.length;et+=1)bt=o[et],st=a[bt],ot+=st&&"function"==typeof st&&st(it.type,it.name)?1:0;if(0===ot)return rt=r.msgInvalidFileType.setTokens({name:ut,types:kt}),void(r.isError=h(rt,it,ft,n))}return 0!==ot||t.isEmpty(s)||!t.isArray(s)||t.isEmpty(yt)||(lt=t.compare(ut,yt),ot+=t.isEmpty(lt)?0:lt.length,0!==ot)?r.showPreview?!tt&&ht>v?(r.addToStack(it),l.addClass("file-thumb-loading"),r._previewDefault(it,ft),r._initFileActions(),r._updateFileDetails(f),void e(n+1)):(y.length&&void 0!==FileReader?(c.html(k.replace("{index}",n+1).replace("{files}",f)),l.addClass("file-thumb-loading"),u.onerror=function(n){r._errorHandler(n,ut)},u.onload=function(t){r._previewFile(n,it,t,ft,gt);r._initFileActions()},u.onloadend=function(){rt=p.setTokens({index:n+1,files:f,percent:50,name:ut});setTimeout(function(){c.html(rt);r._updateFileDetails(f);e(n+1)},100);r._raise("fileloaded",[it,ft,n,u])},u.onprogress=function(t){if(t.lengthComputable){var i=t.loaded/t.total*100,r=Math.ceil(i);rt=p.setTokens({index:n+1,files:f,percent:r,name:ut});setTimeout(function(){c.html(rt)},100)}},pt=a.text,wt=a.image,pt(it.type,ut)?u.readAsText(it,r.textEncoding):wt(it.type,ut)?u.readAsDataURL(it):u.readAsArrayBuffer(it)):(r._previewDefault(it,ft),setTimeout(function(){e(n+1);r._updateFileDetails(f)},100),r._raise("fileloaded",[it,ft,n,u])),void r.addToStack(it)):(r.isUploadable&&r.addToStack(it),setTimeout(function(){e(n+1);r._updateFileDetails(f)},100),void r._raise("fileloaded",[it,ft,n,u])):(rt=r.msgInvalidFileExtension.setTokens({name:ut,extensions:nt}),void(r.isError=h(rt,it,ft,n)))};e(0);r._updateFileDetails(f,!1)},_updateFileDetails:function(n){var i=this,r=i.$element,u=i.getFileStack(),o=t.isIE(9)&&t.findFileName(r.val())||r[0].files[0]&&r[0].files[0].name||u.length&&u[0].name||"",f=i.slug(o),e=i.isUploadable?u.length:n,s=i.previewCache.count()+e,h=e>1?i._getMsgSelected(s):f;i.isError?(i.$previewContainer.removeClass("file-thumb-loading"),i.$previewStatus.html(""),i.$captionContainer.find(".kv-caption-icon").hide()):i._showFileIcon();i._setCaption(h,i.isError);i.$container.removeClass("file-input-new file-input-ajax-new");1===arguments.length&&i._raise("fileselect",[n,f]);i.previewCache.count()&&i._initPreviewActions()},_setThumbStatus:function(n,t){var r=this;if(r.showPreview){var u="indicator"+t,e=u+"Title",o="file-preview-"+t.toLowerCase(),i=n.find(".file-upload-indicator"),f=r.fileActionSettings;n.removeClass("file-preview-success file-preview-error file-preview-loading");"Error"===t&&n.find(".kv-file-upload").attr("disabled",!0);"Success"===t&&(n.find(".file-drag-handle").remove(),i.css("margin-left",0));i.html(f[u]);i.attr("title",f[e]);n.addClass(o)}},_setProgressCancelled:function(){var n=this;n._setProgress(101,n.$progress,n.msgCancelled)},_setProgress:function(n,i,r){var s,u=this,f=Math.min(n,100),e=u.progressUploadThreshold,h=100>=n?u.progressTemplate:u.progressCompleteTemplate,o=100>f?u.progressTemplate:r?u.progressErrorTemplate:h;i=i||u.$progress;t.isEmpty(o)||(s=e&&f>e&&100>=n?o.setTokens({percent:e,status:u.msgUploadThreshold}):o.setTokens({percent:f,status:n>100?u.msgUploadEnd:f+"%"}),i.html(s),r&&i.find('[role="progressbar"]').html(r))},_setFileDropZoneTitle:function(){var r,n=this,i=n.$container.find(".file-drop-zone"),u=n.dropZoneTitle;n.isClickable&&(r=t.isEmpty(n.$element.attr("multiple"))?n.fileSingle:n.filePlural,u+=n.dropZoneClickTitle.replace("{files}",r));i.find("."+n.dropZoneTitleClass).remove();n.isUploadable&&n.showPreview&&0!==i.length&&!(n.getFileStack().length>0)&&n.dropZoneEnabled&&(0===i.find(t.FRAMES).length&&t.isEmpty(n.defaultPreviewContent)&&i.prepend('<div class="'+n.dropZoneTitleClass+'">'+u+"<\/div>"),n.$container.removeClass("file-input-new"),t.addCss(n.$container,"file-input-ajax-new"))},_setAsyncUploadStatus:function(t,i,r){var u=this,f=0;u._setProgress(i,n("#"+t).find(".file-thumb-progress"));u.uploadStatus[t]=i;n.each(u.uploadStatus,function(n,t){f+=t});u._setProgress(Math.floor(f/r))},_validateMinCount:function(){var n=this,t=n.isUploadable?n.getFileStack().length:n.$element.get(0).files.length;return n.validateInitialCount&&n.minFileCount>0&&n._getFileCount(t-1)<n.minFileCount?(n._noFilesError({}),!1):!0},_getFileCount:function(n){var t=this,i=0;return t.validateInitialCount&&!t.overwriteInitial&&(i=t.previewCache.count(),n+=i),n},_getFileId:function(n){var t,r=this,i=r.generateFileId;return"function"==typeof i?i(n,event):n?(t=n.webkitRelativePath||n.fileName||n.name||null,t?n.size+"-"+t.replace(/[^0-9a-zA-Z_-]/gim,""):null):null},_getFileName:function(n){if(n&&n.name)return this.slug(n.name)},_getFileIds:function(n){var t=this;return t.fileids.filter(function(t){return n?void 0!==t:void 0!==t&&null!==t})},_getFileNames:function(n){var t=this;return t.filenames.filter(function(t){return n?void 0!==t:void 0!==t&&null!==t})},_setPreviewError:function(n,t,i){var r=this;void 0!==t&&r.updateStack(t,i);r.removeFromPreviewOnError?n.remove():r._setThumbStatus(n,"Error")},_checkDimensions:function(n,i,r,u,f,e,o){var a,l,s,v,h=this,y="Small"===i?"min":"max",c=h[y+"Image"+e];!t.isEmpty(c)&&r.length&&(s=r[0],l="Width"===e?s.naturalWidth||s.width:s.naturalHeight||s.height,v="Small"===i?l>=c:c>=l,v||(a=h["msgImage"+e+i].setTokens({name:f,size:c}),h._showUploadError(a,o),h._setPreviewError(u,n,null)))},_validateImage:function(t,i,r,u,f){var c,a,v,l,e=this,y=e.$preview,o=y.find("#"+t),h=o.attr("data-fileindex"),s=o.find("img");i=i||"Untitled";s.one("load",function(){a=o.width();v=y.width();a>v&&s.css("width","100%");c={ind:h,id:t};e._checkDimensions(h,"Small",s,o,i,"Width",c);e._checkDimensions(h,"Small",s,o,i,"Height",c);e.resizeImage||(e._checkDimensions(h,"Large",s,o,i,"Width",c),e._checkDimensions(h,"Large",s,o,i,"Height",c));e._raise("fileimageloaded",[t]);l=window.piexif?window.piexif.load(f):null;e.loadedImages.push({ind:h,img:s,thumb:o,pid:t,typ:r,siz:u,validated:!1,imgData:f,exifObj:l});o.data("exif",l);e._validateAllImages()}).one("error",function(){e._raise("fileimageloaderror",[t])}).each(function(){this.complete?n(this).trigger("load"):this.error&&n(this).trigger("error")})},_validateAllImages:function(){var t,i,r,n=this,f={val:0},u=n.loadedImages.length,e=n.resizeIfSizeMoreThan;if(u===n.totalImagesCount&&(n._raise("fileimagesloaded"),n.resizeImage))for(t=0;t<n.loadedImages.length;t++)i=n.loadedImages[t],i.validated||(r=i.siz,r&&r>1e3*e&&n._getResizedImage(i,f,u),n.loadedImages[t].validated=!0)},_getResizedImage:function(i,r,u){var y,p,w,c,l,tt,it,f=this,b=n(i.img)[0],e=b.naturalWidth,o=b.naturalHeight,k=1,a=f.maxImageWidth||e,v=f.maxImageHeight||o,d=!(!e||!o),g=f.imageCanvas,ut=f.imageCanvasContext,nt=i.typ,h=i.pid,s=i.ind,ft=i.thumb,rt=i.exifObj;if(l=function(n,t,i){f.isUploadable?f._showUploadError(n,t,i):f._showError(n,t,i);f._setPreviewError(ft,s)},(!f.filestack[s]||!d||a>=e&&v>=o)&&(d&&f.filestack[s]&&f._raise("fileimageresized",[h,s]),r.val++,r.val===u&&f._raise("fileimagesresized"),!d))return void l(f.msgImageResizeError,{id:h,index:s},"fileimageresizeerror");nt=nt||f.resizeDefaultImageType;p=e>a;w=o>v;k="width"===f.resizePreference?p?a/e:w?v/o:1:w?v/o:p?a/e:1;f._resetCanvas();e*=k;o*=k;g.width=e;g.height=o;try{ut.drawImage(b,0,0,e,o);c=g.toDataURL(nt,f.resizeQuality);rt&&(it=window.piexif.dump(rt),c=window.piexif.insert(it,c));y=t.dataURI2Blob(c);f.filestack[s]=y;f._raise("fileimageresized",[h,s]);r.val++;r.val===u&&f._raise("fileimagesresized",[void 0,void 0]);y instanceof Blob||l(f.msgImageResizeError,{id:h,index:s},"fileimageresizeerror")}catch(et){r.val++;r.val===u&&f._raise("fileimagesresized",[void 0,void 0]);tt=f.msgImageResizeException.replace("{errors}",et.message);l(tt,{id:h,index:s},"fileimageresizeexception")}},_initBrowse:function(n){var t=this;t.showBrowse?(t.$btnFile=n.find(".btn-file"),t.$btnFile.append(t.$element)):t.$element.hide()},_initCaption:function(){var n=this,i=n.initialCaption||"";return n.overwriteInitial||t.isEmpty(i)?(n.$caption.html(""),!1):(n._setCaption(i),!0)},_setCaption:function(i,r){var f,o,e,s,u=this,h=u.getFileStack();if(u.$caption.length){if(r)f=n("<div>"+u.msgValidationError+"<\/div>").text(),e=h.length,s=e?1===e&&h[0]?u._getFileNames()[0]:u._getMsgSelected(e):u._getMsgSelected(u.msgNo),o='<span class="'+u.msgValidationErrorClass+'">'+u.msgValidationErrorIcon+(t.isEmpty(i)?s:i)+"<\/span>";else{if(t.isEmpty(i))return;f=n("<div>"+i+"<\/div>").text();o=u._getLayoutTemplate("fileIcon")+f}u.$caption.html(o);u.$caption.attr("title",f);u.$captionContainer.find(".file-caption-ellipsis").attr("title",f)}},_createContainer:function(){var t=this,r={"class":"file-input file-input-new"+(t.rtl?" kv-rtl":"")},i=n(document.createElement("div")).attr(r).html(t._renderMain());return t.$element.before(i),t._initBrowse(i),t.theme&&i.addClass("theme-"+t.theme),i},_refreshContainer:function(){var n=this,t=n.$container;t.before(n.$element);t.html(n._renderMain());n._initBrowse(t)},_renderMain:function(){var n=this,t=n.isUploadable&&n.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",i=n.showClose?n._getLayoutTemplate("close"):"",r=n.showPreview?n._getLayoutTemplate("preview").setTokens({"class":n.previewClass,dropClass:t}):"",u=n.isDisabled?n.captionClass+" file-caption-disabled":n.captionClass,f=n.captionTemplate.setTokens({"class":u+" kv-fileinput-caption"});return n.mainTemplate.setTokens({"class":n.mainClass+(!n.showBrowse&&n.showCaption?" no-browse":""),preview:r,close:i,caption:f,upload:n._renderButton("upload"),remove:n._renderButton("remove"),cancel:n._renderButton("cancel"),browse:n._renderButton("browse")})},_renderButton:function(n){var i=this,u=i._getLayoutTemplate("btnDefault"),f=i[n+"Class"],o=i[n+"Title"],s=i[n+"Icon"],r=i[n+"Label"],h=i.isDisabled?" disabled":"",e="button";switch(n){case"remove":if(!i.showRemove)return"";break;case"cancel":if(!i.showCancel)return"";f+=" hide";break;case"upload":if(!i.showUpload)return"";i.isUploadable&&!i.isDisabled?u=i._getLayoutTemplate("btnLink").replace("{href}",i.uploadUrl):e="submit";break;case"browse":if(!i.showBrowse)return"";u=i._getLayoutTemplate("btnBrowse");break;default:return""}return f+="browse"===n?" btn-file":" fileinput-"+n+" fileinput-"+n+"-button",t.isEmpty(r)||(r=' <span class="'+i.buttonLabelClass+'">'+r+"<\/span>"),u.setTokens({type:e,css:f,title:o,status:h,icon:s,label:r})},_renderThumbProgress:function(){var n=this;return'<div class="file-thumb-progress hide">'+n.progressTemplate.setTokens({percent:"0",status:n.msgUploadBegin})+"<\/div>"},_renderFileFooter:function(n,i,r,u){var o,f=this,e=f.fileActionSettings,a=e.showRemove,s=e.showDrag,v=e.showUpload,h=e.showZoom,c=f._getLayoutTemplate("footer"),y=u?e.indicatorError:e.indicatorNew,p=f._getLayoutTemplate("indicator"),w=u?e.indicatorErrorTitle:e.indicatorNewTitle,l=p.setTokens({indicator:y,indicatorTitle:w});return i=f._getSize(i),o=f.isUploadable?c.setTokens({actions:f._renderFileActions(v,a,h,s,!1,!1,!1),caption:n,size:i,width:r,progress:f._renderThumbProgress(),indicator:l}):c.setTokens({actions:f._renderFileActions(!1,!1,h,s,!1,!1,!1),caption:n,size:i,width:r,progress:"",indicator:l}),o=t.replaceTags(o,f.previewThumbTags)},_renderFileActions:function(n,t,i,r,u,f,e,o){if(!(n||t||i||r))return"";var c,h=this,w=f===!1?"":' data-url="'+f+'"',l=e===!1?"":' data-key="'+e+'"',a="",v="",y="",p="",b=h._getLayoutTemplate("actions"),s=h.fileActionSettings,k=h.otherActionButtons.setTokens({dataKey:l}),d=u?s.removeClass+" disabled":s.removeClass;return t&&(a=h._getLayoutTemplate("actionDelete").setTokens({removeClass:d,removeIcon:s.removeIcon,removeTitle:s.removeTitle,dataUrl:w,dataKey:l})),n&&(v=h._getLayoutTemplate("actionUpload").setTokens({uploadClass:s.uploadClass,uploadIcon:s.uploadIcon,uploadTitle:s.uploadTitle})),i&&(y=h._getLayoutTemplate("actionZoom").setTokens({zoomClass:s.zoomClass,zoomIcon:s.zoomIcon,zoomTitle:s.zoomTitle})),r&&o&&(c="drag-handle-init "+s.dragClass,p=h._getLayoutTemplate("actionDrag").setTokens({dragClass:c,dragTitle:s.dragTitle,dragIcon:s.dragIcon})),b.setTokens({"delete":a,upload:v,zoom:y,drag:p,other:k})},_browse:function(n){var t=this;t._raise("filebrowse");n&&n.isDefaultPrevented()||(t.isError&&!t.isUploadable&&t.clear(),t.$captionContainer.focus())},_filterDuplicate:function(n,t,i){var u=this,r=u._getFileId(n);r&&i&&i.indexOf(r)>-1||(i||(i=[]),t.push(n),i.push(r))},_change:function(i){var r=this,h=r.$element;if(!r.isUploadable&&t.isEmpty(h.val())&&r.fileInputCleared)return void(r.fileInputCleared=!1);r.fileInputCleared=!1;var l,s,a,f,u=[],v=arguments.length>1,o=r.isUploadable,e=v?i.originalEvent.dataTransfer.files:h.get(0).files,y=r.filestack.length,b=t.isEmpty(h.attr("multiple")),p=b&&y>0,c=0,w=r._getFileIds(),k=function(t,i,u,f){var o=n.extend(!0,{},r._getOutData({},{},e),{id:u,index:f}),s={id:u,index:f,file:i,files:e};return r.isUploadable?r._showUploadError(t,o):r._showError(t,s)};if(r.reader=null,r._resetUpload(),r._hideFileIcon(),r.isUploadable&&r.$container.find(".file-drop-zone ."+r.dropZoneTitleClass).remove(),v?n.each(e,function(n,t){t&&!t.type&&void 0!==t.size&&t.size%4096==0?c++:r._filterDuplicate(t,u,w)}):(e=i.target&&void 0===i.target.files?i.target.value?[{name:i.target.value.replace(/^.+\\/,"")}]:[]:i.target.files||{},o?n.each(e,function(n,t){r._filterDuplicate(t,u,w)}):u=e),t.isEmpty(u)||0===u.length)return o||r.clear(),r._showFolderError(c),void r._raise("fileselectnone");if(r._resetErrors(),f=u.length,s=r._getFileCount(r.isUploadable?r.getFileStack().length+f:f),r.maxFileCount>0&&s>r.maxFileCount){if(!r.autoReplace||f>r.maxFileCount)return a=r.autoReplace&&f>r.maxFileCount?f:s,l=r.msgFilesTooMany.replace("{m}",r.maxFileCount).replace("{n}",a),r.isError=k(l,null,null,null),r.$captionContainer.find(".kv-caption-icon").hide(),r._setCaption("",!0),void r.$container.removeClass("file-input-new file-input-ajax-new");s>r.maxFileCount&&r._resetPreviewThumbs(o)}else!o||p?(r._resetPreviewThumbs(!1),p&&r.clearStack()):!o||0!==y||r.previewCache.count()&&!r.overwriteInitial||r._resetPreviewThumbs(!0);r.isPreviewable?r._readFiles(u):r._updateFileDetails(1);r._showFolderError(c)},_abort:function(t){var r,i=this;return i.ajaxAborted&&"object"==typeof i.ajaxAborted&&void 0!==i.ajaxAborted.message?(r=n.extend(!0,{},i._getOutData(),t),r.abortData=i.ajaxAborted.data||{},r.abortMessage=i.ajaxAborted.message,i._setProgress(101,i.$progress,i.msgCancelled),i._showUploadError(i.ajaxAborted.message,r,"filecustomerror"),i.cancel(),!0):!1},_resetFileStack:function(){var i=this,r=0,u=[],f=[],e=[];i._getThumbs().each(function(){var h,o=n(this),c=o.attr("data-fileindex"),s=i.filestack[c],l=o.attr("id");"-1"!==c&&-1!==c&&(void 0!==s?(u[r]=s,f[r]=i._getFileName(s),e[r]=i._getFileId(s),o.attr({id:i.previewInitId+"-"+r,"data-fileindex":r}),r++):(h="uploaded-"+t.uniqId(),o.attr({id:h,"data-fileindex":"-1"}),i.$preview.find("#zoom-"+l).attr("id","zoom-"+h)))});i.filestack=u;i.filenames=f;i.fileids=e},_isFileSelectionValid:function(n){var t=this;return n=n||0,t.required&&!t.getFilesCount()?(t.$errorContainer.html(""),t._showUploadError(t.msgFileRequired),!1):t.minFileCount>0&&t._getFileCount(n)<t.minFileCount?(t._noFilesError({}),!1):!0},clearStack:function(){var n=this;return n.filestack=[],n.filenames=[],n.fileids=[],n.$element},updateStack:function(n,t){var i=this;return i.filestack[n]=t,i.filenames[n]=i._getFileName(t),i.fileids[n]=t&&i._getFileId(t)||null,i.$element},addToStack:function(n){var t=this;return t.filestack.push(n),t.filenames.push(t._getFileName(n)),t.fileids.push(t._getFileId(n)),t.$element},getFileStack:function(n){var t=this;return t.filestack.filter(function(t){return n?void 0!==t:void 0!==t&&null!==t})},getFilesCount:function(){var n=this,t=n.isUploadable?n.getFileStack().length:n.$element.get(0).files.length;return n._getFileCount(t)},lock:function(){var n=this;return n._resetErrors(),n.disable(),n.showRemove&&t.addCss(n.$container.find(".fileinput-remove"),"hide"),n.showCancel&&n.$container.find(".fileinput-cancel").removeClass("hide"),n._raise("filelock",[n.filestack,n._getExtraData()]),n.$element},unlock:function(n){var i=this;return void 0===n&&(n=!0),i.enable(),i.showCancel&&t.addCss(i.$container.find(".fileinput-cancel"),"hide"),i.showRemove&&i.$container.find(".fileinput-remove").removeClass("hide"),n&&i._resetFileStack(),i._raise("fileunlock",[i.filestack,i._getExtraData()]),i.$element},cancel:function(){var i,t=this,r=t.ajaxRequests,u=r.length;if(u>0)for(i=0;u>i;i+=1)t.cancelling=!0,r[i].abort();return t._setProgressCancelled(),t._getThumbs().each(function(){var i=n(this),r=i.attr("data-fileindex");i.removeClass("file-uploading");void 0!==t.filestack[r]&&(i.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),i.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled"));t.unlock()}),t.$element},clear:function(){var r,i=this;if(i._raise("fileclear"))return i.$btnUpload.removeAttr("disabled"),i._getThumbs().find("video,audio,img").each(function(){t.cleanMemory(n(this))}),i._resetUpload(),i.clearStack(),i._clearFileInput(),i._resetErrors(!0),i._hasInitialPreview()?(i._showFileIcon(),i._resetPreview(),i._initPreviewActions(),i.$container.removeClass("file-input-new")):(i._getThumbs().each(function(){i._clearObjects(n(this))}),i.isUploadable&&(i.previewCache.data={}),i.$preview.html(""),r=!i.overwriteInitial&&i.initialCaption.length>0?i.initialCaption:"",i.$caption.html(r),i.$caption.attr("title",""),t.addCss(i.$container,"file-input-new"),i._validateDefaultPreview()),0===i.$container.find(t.FRAMES).length&&(i._initCaption()||i.$captionContainer.find(".kv-caption-icon").hide()),i._hideFileIcon(),i._raise("filecleared"),i.$captionContainer.focus(),i._setFileDropZoneTitle(),i.$element},reset:function(){var n=this;if(n._raise("filereset"))return n._resetPreview(),n.$container.find(".fileinput-filename").text(""),t.addCss(n.$container,"file-input-new"),(n.getFrames().length||n.isUploadable&&n.dropZoneEnabled)&&n.$container.removeClass("file-input-new"),n._setFileDropZoneTitle(),n.clearStack(),n.formdata={},n.$element},disable:function(){var n=this;return n.isDisabled=!0,n._raise("filedisabled"),n.$element.attr("disabled","disabled"),n.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),n.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),n._initDragDrop(),n.$element},enable:function(){var n=this;return n.isDisabled=!1,n._raise("fileenabled"),n.$element.removeAttr("disabled"),n.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),n.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),n._initDragDrop(),n.$element},upload:function(){var r,e,u,i=this,f=i.getFileStack().length,o=!n.isEmptyObject(i._getExtraData());if(i.isUploadable&&!i.isDisabled&&i._isFileSelectionValid(f)){if(i._resetUpload(),0===f&&!o)return void i._showUploadError(i.msgUploadEmpty);if(i.$progress.removeClass("hide"),i.uploadCount=0,i.uploadStatus={},i.uploadLog=[],i.lock(),i._setProgress(2),0===f&&o)return void i._uploadExtraOnly();if(u=i.filestack.length,i.hasInitData=!1,!i.uploadAsync)return i._uploadBatch(),i.$element;for(e=i._getOutData(),i._raise("filebatchpreupload",[e]),i.fileBatchCompleted=!1,i.uploadCache={content:[],config:[],tags:[],append:!0},i.uploadAsyncCount=i.getFileStack().length,r=0;u>r;r++)i.uploadCache.content[r]=null,i.uploadCache.config[r]=null,i.uploadCache.tags[r]=null;for(i.$preview.find(".file-preview-initial").removeClass(t.SORT_CSS),i._initSortable(),i.cacheInitialPreview=i.getPreview(),r=0;u>r;r++)void 0!==i.filestack[r]&&i._uploadSingle(r,i.filestack,!0)}},destroy:function(){var t=this,r=t.$form,u=t.$container,f=t.$element,i=t.namespace;return n(document).off(i),n(window).off(i),r&&r.length&&r.off(i),t.isUploadable&&t._clearFileInput(),t._cleanup(),t._initPreviewCache(),f.insertBefore(u).off(i).removeData(),u.off().remove(),f},refresh:function(t){var i=this,r=i.$element;return t=t?n.extend(!0,{},i.options,t):i.options,i.destroy(),r.fileinput(t),i=r.data("fileinput"),i.isUploadable&&i._clearFileInput(),r.val()&&r.trigger("change.fileinput"),r},zoom:function(n){var i=this,u=i._getFrame(n),r=i.$modal;u&&(t.initModal(r),r.html(i._getModalContent()),i._setZoomContent(u),r.modal("show"),i._initZoomButtons())},getExif:function(n){var i=this,t=i._getFrame(n);return t&&t.data("exif")||null},getFrames:function(n){var i=this;return n=n||"",i.$preview.find(t.FRAMES+n)},getPreview:function(){var n=this;return{content:n.initialPreview,config:n.initialPreviewConfig,tags:n.initialPreviewThumbTags}}};n.fn.fileinput=function(r){if(t.hasFileAPISupport()||t.isIE(9)){var f=Array.apply(null,arguments),u=[];switch(f.shift(),this.each(function(){var c,e=n(this),o=e.data("fileinput"),s="object"==typeof r&&r,l=s.theme||e.data("theme"),a={},v={},h=s.language||e.data("language")||n.fn.fileinput.defaults.language||"en";o||(l&&(v=n.fn.fileinputThemes[l]||{}),"en"===h||t.isEmpty(n.fn.fileinputLocales[h])||(a=n.fn.fileinputLocales[h]||{}),c=n.extend(!0,{},n.fn.fileinput.defaults,v,n.fn.fileinputLocales.en,a,s,e.data()),o=new i(this,c),e.data("fileinput",o));"string"==typeof r&&u.push(o[r].apply(o,f))}),u.length){case 0:return this;case 1:return u[0];default:return u}}};n.fn.fileinput.defaults={language:"en",showCaption:!0,showBrowse:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showClose:!0,showUploadedThumbs:!0,browseOnZoneClick:!1,autoReplace:!1,autoOrientImage:!0,required:!1,rtl:!1,hideThumbnailContent:!1,generateFileId:null,previewClass:"",captionClass:"",frameClass:"krajee-default",mainClass:"file-caption-main",mainTemplate:null,purifyHtml:!0,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"><\/i>',next:'<i class="glyphicon glyphicon-triangle-right"><\/i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"><\/i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"><\/i>',borderless:'<i class="glyphicon glyphicon-resize-full"><\/i>',close:'<i class="glyphicon glyphicon-remove"><\/i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-default btn-header-toggle",fullscreen:"btn btn-default",borderless:"btn btn-default",close:"btn btn-default"},preferIconicPreview:!1,preferIconicZoomPreview:!1,allowedPreviewTypes:void 0,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="glyphicon glyphicon-file"><\/i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"><\/i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"><\/i>',removeClass:"btn btn-default",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"><\/i>',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"><\/i>',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",resizeIfSizeMoreThan:0,minFileSize:0,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"><\/i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar progress-bar-success progress-bar-striped active",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",progressErrorClass:"progress-bar progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:'<span class="close kv-error-close">&times;<\/span>',slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0};n.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgZoomModalHeading:"Detailed Preview",msgFileRequired:"You must select a file to upload.",msgSizeTooSmall:'File "{name}" (<b>{size} KB<\/b>) is too small and must be larger than <b>{minSize} KB<\/b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB<\/b>) exceeds maximum allowed upload size of <b>{maxSize} KB<\/b>.',msgFilesTooLess:"You must select at least <b>{n}<\/b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})<\/b> exceeds maximum allowed limit of <b>{m}<\/b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing...",msgUploadBegin:"Initializing...",msgUploadEnd:"Done",msgUploadEmpty:"No valid data available for upload.",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}<\/pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",previewZoomButtonTitles:{prev:"View previous file",next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}};n.fn.fileinput.Constructor=i;n(document).ready(function(){var t=n("input.file[type=file]");t.length&&t.fileinput()})});
/*!
 * FileInput Persian Translations
 *
 * This file must be loaded after 'fileinput.js'. Patterns in braces '{}', or
 * any HTML markup tags in the messages must not be converted or translated.
 *
 * @see http://github.com/kartik-v/bootstrap-fileinput
 * @author Milad Nekofar <milad@nekofar.com>
 *
 * NOTE: this file must be saved in UTF-8 encoding.
 */
(function(n){"use strict";n.fn.fileinputLocales.fa={fileSingle:"فایل",filePlural:"فایل",browseLabel:"مرور &hellip;",removeLabel:"حذف",removeTitle:"پاکسازی فایل‌های انتخاب شده",cancelLabel:"لغو",cancelTitle:"لغو بارگزاری جاری",uploadLabel:"بارگذاری",uploadTitle:"بارگذاری فایل‌های انتخاب شده",msgNo:"نه",msgNoFilesSelected:"هیچ فایلی انتخاب نشده است",msgCancelled:"لغو شد",msgZoomModalHeading:"نمایش با جزییات",msgFileRequired:"You must select a file to upload.",msgSizeTooSmall:'فایل "{name}" (<b>{size} کیلوبایت<\/b>) خیلی کوچک است و باید از <b>{minSize} کیلوبایت بزرگتر باشد<\/b>.',msgSizeTooLarge:'فایل "{name}" (<b>{size} کیلوبایت<\/b>) از حداکثر مجاز <b>{maxSize} کیلوبایت<\/b> بزرگتر است.',msgFilesTooLess:"شما باید حداقل <b>{n}<\/b> {files} فایل برای بارگذاری انتخاب کنید.",msgFilesTooMany:"تعداد فایل‌های انتخاب شده برای بارگذاری <b>({n})<\/b> از حداکثر مجاز عبور کرده است <b>{m}<\/b>.",msgFileNotFound:'فایل "{name}" یافت نشد!',msgFileSecured:'محدودیت های امنیتی مانع خواندن فایل "{name}" است.',msgFileNotReadable:'فایل "{name}" قابل نوشتن نیست.',msgFilePreviewAborted:'پیش نمایش فایل "{name}". به مشکل خورد',msgFilePreviewError:'در هنگام خواندن فایل "{name}" خطایی رخ داد.',msgInvalidFileName:'کاراکترهای غیرمجاز و یا ناشناخته در نام فایل "{name}".',msgInvalidFileType:'نوع فایل "{name}" معتبر نیست. فقط "{types}" پشیبانی می‌شوند.',msgInvalidFileExtension:'پسوند فایل "{name}" معتبر نیست. فقط "{extensions}" پشتیبانی می‌شوند.',msgFileTypes:{image:"عکس",html:"اچ تا ام ال",text:"متن",video:"ویدئو",audio:"صدا",flash:"فلش",pdf:"پی دی اف",object:"دیگر"},msgUploadAborted:"بارگذاری فایل به مشکل خورد.",msgUploadThreshold:"در حال پردازش...",msgUploadBegin:"در حال شروع...",msgUploadEnd:"انجام شد",msgUploadEmpty:"هیچ داده معتبری برای بارگذاری موجود نیست.",msgValidationError:"خطای اعتبار سنجی",msgLoading:"بارگیری فایل {index} از {files} &hellip;",msgProgress:"بارگیری فایل {index} از {files} - {name} - {percent}% تمام شد.",msgSelected:"{n} {files} انتخاب شده",msgFoldersNotAllowed:"فقط فایل‌ها را بکشید و رها کنید! {n} پوشه نادیده گرفته شد.",msgImageWidthSmall:'عرض فایل تصویر "{name}" باید حداقل {size} پیکسل باشد.',msgImageHeightSmall:'ارتفاع فایل تصویر "{name}" باید حداقل {size} پیکسل باشد.',msgImageWidthLarge:'عرض فایل تصویر "{name}" نمیتواند از {size} پیکسل بیشتر باشد.',msgImageHeightLarge:'ارتفاع فایل تصویر "{name}" نمی‌تواند از {size} پیکسل بیشتر باشد.',msgImageResizeError:"یافت نشد ابعاد تصویر را برای تغییر اندازه.",msgImageResizeException:"خطا در هنگام تغییر اندازه تصویر.<pre>{errors}<\/pre>",msgAjaxError:"به نظر مشکلی در حین {operation} روی داده است. لطفا دوباره تلاش کنید!",msgAjaxProgressError:"{operation} لغو شد",ajaxOperations:{deleteThumb:"حذف فایل",uploadThumb:"بارگذاری فایل",uploadBatch:"بارگذاری جمعی فایلها",uploadExtra:"بارگذاری با کمک فُرم"},dropZoneTitle:"فایل‌ها را بکشید و در اینجا رها کنید &hellip;",dropZoneClickTitle:"<br>(یا برای انتخاب {files} کلیک کنید)",fileActionSettings:{removeTitle:"حذف فایل",uploadTitle:"آپلود فایل",zoomTitle:"دیدن جزئیات",dragTitle:"جابجایی / چیدمان",indicatorNewTitle:"آپلود نشده است",indicatorSuccessTitle:"آپلود شده",indicatorErrorTitle:"بارگذاری خطا",indicatorLoadingTitle:"آپلود ..."},previewZoomButtonTitles:{prev:"مشاهده فایل قبلی",next:"مشاهده فایل بعدی",toggleheader:"نمایش عنوان",fullscreen:"نمایش تمام صفحه",borderless:"نمایش حاشیه",close:"بستن نمایش با جزییات"}}})(window.jQuery);